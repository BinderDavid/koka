<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>time.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;----------------------------------------------------------------------------
   Copyright (C) 2012-2016 Microsoft Corporation
    
   Licensed under the Apache License, Version 2.0 ("The Licence"). You may not
   use this file except in compliance with the License. A copy of the License
   can be found in the file "license.txt" at the root of this distribution.
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; Date and time functionality.

This is an extensive library for managing time and supports advanced features
as multiple calendars, astronomical time scales, accurate leap seconds, and time zones.
Times span arbitrary far in the past and future, and calculations are accurate
up to femto-seconds (1&amp;times;10^-15^s).

Core concepts are:

&#42; An &#96;:instant&#96; represents an instant in time. Instants can be substracted to
get the &#96;:duration&#96; between them. Instands are usually represented as the number
of fractional SI seconds since the &#96;epoch&#96; (2000-01-01Z), but can be represented
in different time scales for efficiency. For example, there is the TAI time scale (&#96;ts-tai&#96;),
standard UTC (&#96;ts-utc&#96;), or astronimical time scales like terrestrial time (&#96;std/time/astro/ts-tt&#96;).

&#42; A &#96;:time&#96; is a human readable &#96;:date&#96; (year, month, day), and &#96;:clock&#96; (hour, minutes, seconds)
in a particular &#96;:calendar&#96; (usually the standard ISO calendar) and time zone. 
Instants can be converted to 
time values and back. We can add years, months, or days to a &#96;:time&#96;, or get the difference
between times in days etc.

&#42; A &#96;:duration&#96; is a span of time in fractional SI seconds. 

Months, weeks, days etc. are always 1-based, while durations are always in (fractional) seconds.

The current time, in the local timezone (&#96;tz-local&#96;) using the ISO calendar (&#96;cal-iso&#96;):

&#96;&#96;&gt;&#96;&#96; &#96;time-now&#96;\/&#96;&#96;()&#96;&#96;\
&#96;&#96;2017-01-30T15:40:25.367000103Z&#96;&#96;

Or the current time in the local timezone:

&#96;&#96;&gt;&#96;&#96; &#96;local-time-now&#96;\/&#96;&#96;()&#96;&#96;\
&#96;&#96;2017-01-30T07:59:01.693000078-08:00 (PST)&#96;&#96;

We can also get the current instant in time as the number of SI seconds since the &#96;epoch&#96;:

&#96;&#96;&gt;&#96;&#96; &#96;now&#96;\/&#96;&#96;()&#96;&#96;\
&#96;&#96;539106063.980999947s&#96;&#96;

Calendar times can be constructed by giving a year, month (1-based), and day of the month (1-based)
and optional hour, minutes, seconds, fraction of the second, timezone (&#96;tz-utc&#96;) and
calendar (&#96;cal-iso&#96;):

&#96;&#96;&gt;&#96;&#96; &#96;time(2000,1,1)&#96;\
&#96;&#96;2000-01-01T00:00:00Z&#96;&#96;

Instants can be constructed similarly (except no calendar or timezone can be given). 
Times can be constructed from instants. Here we construct a time value interpreted in using
the TAI time scale (which was 32 seconds ahead of UTC on 2000-01-01Z):

&#96;&#96;&gt;&#96;&#96; &#96;instant(2000,1,1).time(cal=cal-tai)&#96;\
&#96;&#96;2000-01-01T00:00:32Z TAI&#96;&#96;

The library takes much care to correctly handle leap seconds and time zone transitions.
For example, here are some durations between different times:

&#96;(time(2016,1,1,0,0,0,0.5) - time(2015,12,31,23,59,59)).show == "1.5s"&#96;\
&#96;(time(2017,1,1,0,0,0,0.5) - time(2016,12,31,23,59,59)).show == "2.5s"&#96;  &amp;quad; (over a leap second)\
&#96;(time(2017,1,1,0,0,0,0.5) - time(2017,1,1,2,59,59,tz=tz-fixed(3)).show == "2.5s"&#96;  &amp;quad; (GMT+3, and over a leap second)\

Similarly, adding logical &#95;days&#95; (or weeks, months, or years) works over leap seconds and
other time irregularties:

&#96;time(2016,12,31,12).add-days(1).show == "2017-01-01T12:00:00Z"&#96; &amp;quad; (over a leap second)\
&#96;time(1582,10,4,cal=cal-jg).add-days(1).show == "1582-10-15T00:00:00Z JG"&#96; &amp;quad; (transition from Julian (&#96;cal-julian&#96;) to Gregorian (&#96;cal-gregorian&#96;) calendar)\

To calculate correctly with leap-seconds, it is recommended to call &#96;update-leaps-table&#96;
at the start of a progrom which will ensure leap second information is up-to-date (automatically
downloading and caching the latest IETF leap second table if required). See the &#96;std/time/utc&#96;
module for more information. Similarly, if calculating with timezones besides the UTC (&#96;tz-utc&#96;)
and local timezone (&#96;tz-local&#96;), one needs to use the [&#96;std/time/timezone&#96;](std&#95;time&#95;timezone.html) 
modules to load the latest time zone information ([&#96;std/time/timezone/load-timezones&#96;](std&#95;time&#95;timezone.html#load&#95;timezones)).

&#96;&#96;&#96;koka
import std/time
import std/time/timezone

fun test-timezones() {
  val tzs = load-timezones()
  val z1  = tzs.timezone("America/New&#95;York")
  val z2  = tzs.timezone("Asia/Tehran")
  val t1  = instant(1978,12,30,12,1,0,tz=z1) + (14.hours + 44.minutes)
  t1.time(tz=z2).show.println()  // 1978-12-31T11:45:00+04:00 (IRST)
  val t2  = instant(1978,12,31,12,1,0,tz=z1) + (14.hours + 44.minutes) // across DST &amp; leap second
  t2.time(tz=z2).show.println   // 1979-01-01T11:14:59+03:30 (IRST)"
}
&#96;&#96;&#96;
.
&#42;/</span>
<span class="kw">module</span> time

<span class="kw">public</span> <span class="kw">import</span> duration
<span class="kw">public</span> <span class="kw">import</span> instant
<span class="kw">public</span> <span class="kw">import</span> utc
<span class="kw">public</span> <span class="kw">import</span> chrono
<span class="kw">public</span> <span class="kw">import</span> timer

<span class="kw">public</span> <span class="kw">import</span> download
<span class="kw">public</span> <span class="kw">import</span> date
<span class="kw">public</span> <span class="kw">import</span> calendar
<span class="kw">public</span> <span class="kw">import</span> calendars
<span class="kw">public</span> <span class="kw">import</span> time

<span class="kw">public</span> <span class="kw">import</span> locale
<span class="kw">public</span> <span class="kw">import</span> format
<span class="kw">public</span> <span class="kw">import</span> parse
</pre>

</div></body>
</html>
