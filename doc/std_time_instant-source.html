<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>instant.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;----------------------------------------------------------------------------
   Copyright (C) 2012-2016 Microsoft Corporation
    
   Licensed under the Apache License, Version 2.0 ("The Licence"). You may not
   use this file except in compliance with the License. A copy of the License
   can be found in the file "license.txt" at the root of this distribution.
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; Instants in time.

   Instants can be arbitrary far into the past
   and future and are precise up to 10^-15^s (a femto-second). 
   Internally, instants are represented in a certain time scale (&#96;:timescale&#96;) for
   efficiency and precision. They automatically convert between different time scales 
   when necessary (for example when comparing instants in time, or calculating durations
   between UTC calendar times).

   Time durations (&#96;:duration&#96;) are always in SI seconds (as measured on the Earth's geoid).
&#42;/</span>
<span class="kw">module</span> instant

<span class="kw">import</span> fixed
<span class="kw">import</span> timestamp
<span class="kw">import</span> duration

<span class="comment">/&#42;----------------------------------------------------------------------------
  Instant
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Represents an instant in time. Instants can be arbitrary far into the past
// and future and are precise up to 10^-15^s (a femto-second). 
// Internally, instants are represented in a certain time scale (&#96;:timescale&#96;) for
// efficiency and precision. They automatically convert between different time scales 
// when necessary (for example when comparing instants in time, or calculating durations
// between UTC calendar times).
</span><span class="decl-type" id="type_space_instant"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Instant"><a class="pp" href="std_time_instant.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>(
  <span class="decl-fun" id="since"><a class="pp">since<span class="pc">since: <span class="tp">timestamp</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>,  <span class="comment">// since the time-scale epoch
</span>  <span class="decl-fun" id="ts"><a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a></span>    <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>   <span class="comment">// the time scale (TAI, UTC, etc)
</span></span></span>)

<span class="comment">/&#42;----------------------------------------------------------------------------
  Timescale
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// A time scale defines how time is measured, defines the unit of time, the epoch,
// and how it can be converted to- and from TAI.\
// For time calculations, usually the [TAI](https://en.wikipedia.org/wiki/International&#95;Atomic&#95;Time)
// (international atomic time) time scale (&#96;ts-tai&#96;) is used which is time measured as SI seconds on the Earths geoid.
// Another common time scale is UTC (&#96;std/time/utc/ts-utc&#96;) which also uses SI second time units but can contain leap seconds.
</span><span class="decl-type" id="type_space_timescale"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Timescale"><a class="pp" href="std_time_instant.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>(
  <span class="kw">public</span> <span class="decl-fun" id="name"><a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>,
  <span class="decl-fun" id="unit"><a class="pp">unit<span class="pc">unit: <span class="tp">string</span></span></a></span>        <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>,
  <span class="decl-fun" id="from_tai"><a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a></span>    <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>,
  <span class="decl-fun" id="to_tai"><a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a></span>      <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>,
  <span class="comment">// The y2k-epoch states at what timestamp &#95;in this timescale&#95; is the date 2001-01-01.
</span>  <span class="comment">// It is used for date calculations.
</span>  <span class="comment">// y2k-epoch = instant(2000,1,1,cal=iso-calendar(&lt;ts&gt;).timestamp(&lt;ts&gt;) with &lt;ts&gt; this timescale
</span>  <span class="decl-fun" id="y2k_epoch"><a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp">timestamp</span></span></a></span>   <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>,
  <span class="decl-fun" id="epoch_shift"><a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timespan0">timespan0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan0: <span class="tp">timespan</span></span></a>,
  <span class="decl-fun" id="secs_in_day"><a class="pp">secs-in-day<span class="pc">secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="kw">=</span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
</span></span>)


<span class="comment">/&#42;----------------------------------------------------------------------------
  Instant operations
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Change the internal representation of an instant to use another timescale.
// Only used in special cases for efficiency. For example, when comparing an 
// instant in TAI time to thousands of UTC times, it is more efficient to convert
// the TAI time to UTC first to avoid converting at each comparision.
</span><span class="decl-fun" id="use"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#use">use<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>use: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_eq__eq__3">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>) <span class="kw">then</span> {
    <span class="comment">// already using the right time scale
</span>    <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>
  }
  <span class="kw">else</span> {
    <a class="pp" href="#con_space_Instant"><span class="co">Instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Instant: <span class="tp sp">(</span><span class="tp tpp">since</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a>), <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a> )
  }
</span>}

<span class="comment">// Convert a timestamp between time scales
</span><span class="decl-fun" id="convert"><span class="kw">fun</span> <a class="pp" href="std_time_instant.html#convert">convert<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>convert: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">from</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">to</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">from<span class="pc">from: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>, <a class="pp">to<span class="pc">to: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">from</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_eq__eq__3">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">to<span class="pc">to: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>) <span class="kw">then</span> {
    <span class="comment">// already using the right time scale
</span>    <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>
  }
  <span class="kw">elif</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">!</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">from<span class="pc">from: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#unit">unit<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unit: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#empty_ques__1">empty?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>empty?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">from<span class="pc">from: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#unit">unit<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unit: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_eq__eq__3">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">to<span class="pc">to: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#unit">unit<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unit: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>) <span class="kw">then</span> {
    <span class="comment">// just an epoch shift
</span>    <span class="comment">// important optimization as it allows UNIX timestamp to UTC conversion without going through TAI for example
</span>    <span class="comment">// trace( "instant use: shift: " + from.name + " -&gt; " + to.name + ", " + from.epoch-shift.ts-show + " vs. " + to.epoch-shift.ts-show + ", t: " + t.show )
</span>    (<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">from<span class="pc">from: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#epoch_shift">epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>epoch<span class="dash">-</span>shift: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>) <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">to<span class="pc">to: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#epoch_shift">epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>epoch<span class="dash">-</span>shift: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
  }
  <span class="kw">else</span> {
    <span class="comment">// transform through TAI
</span>    <span class="comment">// trace( "convert: " + from.name + " -&gt; " + to.name +  ", t: " + t.show )
</span>    (<a class="pp">to<span class="pc">to: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#from_tai">from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">)</span></span></a>)( (<a class="pp">from<span class="pc">from: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#to_tai">to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">)</span></span></a>)(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>) ) 
  }
</span>}

<span class="comment">// Return the &#96;:duration&#96; since the &#96;epoch&#96; for a timestamp &#96;t&#96; interpreted in time scale &#96;ts&#96;.
</span><span class="decl-fun" id="to_tai_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#to_tai_1">to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>to<span class="dash">-</span>tai<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(  <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> {
  <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="#convert">convert<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>convert: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">from</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">to</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>,<a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#unsafe_duration_1">unsafe-duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>duration<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>
</span>}

<span class="comment">// Given a &#96;:duration&#96; since the &#96;epoch&#96;, return a &#96;:timestamp&#96; for that instant in time scale &#96;ts&#96;.
</span><span class="decl-fun" id="from_tai_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#from_tai_1">from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>from<span class="dash">-</span>tai<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>, <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="#convert">convert<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>convert: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">from</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">to</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a>,<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Returns the 'seconds' in the day of a timestamp with a given timescale.
// Is always 86400 for any timescale except UTC timescales after 1972 where a day
// can be 86399 up to 86401 due to leap seconds.
</span><span class="decl-fun" id="seconds_in_day"><span class="kw">fun</span> <a class="pp" href="std_time_instant.html#seconds_in_day">seconds-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>seconds<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>( <a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> {
  <span class="kw">match</span>(<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#secs_in_day">secs-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>
    <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>) <span class="kw op">-></span> <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a>)
  }
</span>}

<span class="comment">// Return the time scale that instant &#96;i&#96; uses.
</span><span class="decl-fun" id="timescale"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#timescale">timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>
</span>}

<span class="comment">// Return a &#96;:timestamp&#96; for instant &#96;i&#96; in a certain time scale &#96;tscale&#96; (= &#96;ts-tai&#96;).
</span><span class="decl-fun" id="timestamp"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">tscale<span class="pc">tscale: <span class="tp op">?</span><span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#since">since<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="#convert">convert<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>convert: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">from</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">to</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>,<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Return a &#96;:timespan&#96; for instant &#96;i&#96; in a certain time scale &#96;tscale&#96; (= &#96;ts-tai&#96;) (since the &#96;tscale&#96; epoch).
</span><span class="decl-fun" id="timespan"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">tscale<span class="pc">tscale: <span class="tp op">?</span><span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
</span>}

<span class="comment">// Create an instant from a time stamp &#96;t&#96; interpreted in time scale &#96;ts&#96;.\
// Be careful to ensure that &#96;t&#96; should indeed be interepreted in the given time scale.
</span><span class="decl-fun" id="unsafe_instant"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#con_space_Instant"><span class="co">Instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Instant: <span class="tp sp">(</span><span class="tp tpp">since</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>,<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Round an instant to a certain precision (&#96;prec&#96; is number of digits of the fraction of the second).\
// Takes special care for instants that use a UTC timescale to round into leap seconds if appropriate.
</span><span class="decl-fun" id="round_to_prec"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#round_to_prec">round-to-prec<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>round<span class="dash">-</span>to<span class="dash">-</span>prec: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">prec<span class="pc">prec: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">prec</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#neg_ques__1">neg?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>neg?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>
  <span class="kw">elif</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#has_leap_seconds">has-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>has<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) 
   <span class="comment">// Round on TAI representation instead; assumes the leap second time scale has SI seconds (which UTC has)
</span>   <span class="comment">// TODO: optimize to round first on UTC, and only when necessary convert to TAI
</span>   <span class="kw">then</span> <a class="pp" href="#con_space_Instant"><span class="co">Instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Instant: <span class="tp sp">(</span><span class="tp tpp">since</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#use">use<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>use: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="#since">since<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#round_to_prec">round-to-prec<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>round<span class="dash">-</span>to<span class="dash">-</span>prec: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">prec<span class="pc">prec: <span class="tp">int</span></span></a>), <a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a> ) 
   <span class="kw">else</span> <a class="pp" href="#con_space_Instant"><span class="co">Instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Instant: <span class="tp sp">(</span><span class="tp tpp">since</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#since">since<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#round_to_prec">round-to-prec<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>round<span class="dash">-</span>to<span class="dash">-</span>prec: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">prec<span class="pc">prec: <span class="tp">int</span></span></a>), <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a> )
</span>}

<span class="comment">// Does this time scale have leap seconds? (only for UTC time (&#96;ts-utc&#96;, &#96;ts-unix&#96;, and &#96;ts-ntp&#96;))
</span><span class="decl-fun" id="has_leap_seconds"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#has_leap_seconds">has-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>has<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#secs_in_day">secs-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#just_ques_">just?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>just?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">maybe</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
</span>}

<span class="comment">// Our epoch is set at 2000-01-01 TAI (which is equal to 1999-12-31T23:59:28Z UTC).
//
// Another candidate epoch could have been the standard [J2000] epoch ([&#96;epoch-j2000&#96;](std&#95;time&#95;astro.html#epoch&#95;j2000)), 
// which equals 2000-01-01T12:00:00 TT (terrestrial time).
// However, that would mean that for the most common time scales, namely UTC and TAI, there would always be a 
// fractional offset (of 32.184s) for common time stamps. Moreover, by having an epoch at noon there would be
// an extra correction needed for calendar date calculations too. 
//
// Similarly, the standard Unix epoch of 1970-01-01Z UTC is not ideal either since the UTC offset with TAI
// was fractional at that time (namely 8.000082s).
//
// Given these issues, we fixed the epoch at 2000-01-01T00:00:00 TAI instead.
//
// [J2000]: https://en.wikipedia.org/wiki/Equinox&#95;(celestial&#95;coordinates)#J2000.0
</span><span class="decl-val" id="epoch"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_instant.html#epoch">epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>epoch: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Instant"><span class="co">Instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Instant: <span class="tp sp">(</span><span class="tp tpp">since</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,<a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a></span>)

<span class="comment">// Return the (TAI) SI second duration since the &#96;epoch&#96; at this instant.
</span><span class="decl-fun" id="since_epoch"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#since_epoch">since-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#unsafe_duration_1">unsafe-duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>duration<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>
</span>}

<span class="comment">// Return the instant at (TAI) SI seconds duration since the &#96;epoch&#96;.
</span><span class="decl-fun" id="instant_since_epoch"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#instant_since_epoch">instant-since-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>since<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>, <a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Compare two &#96;:instant&#96;s in time.
</span><span class="decl-fun" id="compare"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_order"><span class="tp">order</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>order: <span class="tp">V</span></span></a> {
  <a class="pp" href="std_time_timestamp-source.html#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#since">since<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#use">use<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>use: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="#since">since<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>)
</span>}

<span class="decl-fun" id="_lt_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_lt_">(&lt;)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> )  <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> { <a class="pp" href="#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>,<a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <a class="pp" href="std_core-source.html#_eq__eq__4">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#con_space_Lt"><span class="co">Lt</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Lt: <span class="tp">order</span></span></a> </span>}
<span class="decl-fun" id="_lt__eq_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_lt__eq_">(&lt;=)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> { <a class="pp" href="#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>,<a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <a class="pp" href="std_core-source.html#_excl__eq__4">!=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!=)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#con_space_Gt"><span class="co">Gt</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Gt: <span class="tp">order</span></span></a> </span>}
<span class="decl-fun" id="_gt_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_gt_">(&gt;)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> )  <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> { <a class="pp" href="#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>,<a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <a class="pp" href="std_core-source.html#_eq__eq__4">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#con_space_Gt"><span class="co">Gt</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Gt: <span class="tp">order</span></span></a> </span>}
<span class="decl-fun" id="_gt__eq_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_gt__eq_">(&gt;=)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(&gt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> { <a class="pp" href="#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>,<a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <a class="pp" href="std_core-source.html#_excl__eq__4">!=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!=)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#con_space_Lt"><span class="co">Lt</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Lt: <span class="tp">order</span></span></a> </span>}
<span class="decl-fun" id="_eq__eq_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_eq__eq_">(==)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> { <a class="pp" href="#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>,<a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <a class="pp" href="std_core-source.html#_eq__eq__4">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#con_space_Eq"><span class="co">Eq</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Eq: <span class="tp">order</span></span></a> </span>}
<span class="decl-fun" id="_excl__eq_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_excl__eq_">(!=)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(!=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> { <a class="pp" href="#compare">compare<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>compare: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">order</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a>,<a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <a class="pp" href="std_core-source.html#_excl__eq__4">!=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!=)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">order</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#con_space_Eq"><span class="co">Eq</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Eq: <span class="tp">order</span></span></a> </span>}

<span class="comment">// The minimum of two instants.
</span><span class="decl-fun" id="min"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#min">min<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>min: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <span class="kw">then</span> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="kw">else</span> <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>
</span>}

<span class="comment">// The maximum of two instants.
</span><span class="decl-fun" id="max"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#max">max<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>max: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="#_gt__eq_">&gt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(&gt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>) <span class="kw">then</span> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="kw">else</span> <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a>
</span>}

<span class="comment">// Add a duration to an instant in time.
</span><span class="decl-fun" id="_plus_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_plus_">(+)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#unit">unit<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unit: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><a class="pp" href="std_core-source.html#_eq__eq__3">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="st">"TAI"</span>)
   <span class="kw">then</span> <a class="pp" href="#con_space_Instant"><span class="co">Instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Instant: <span class="tp sp">(</span><span class="tp tpp">since</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#since">since<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>, <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a> ) <span class="comment">// directly add
</span>   <span class="kw">else</span> <a class="pp" href="#con_space_Instant"><span class="co">Instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Instant: <span class="tp sp">(</span><span class="tp tpp">since</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a>) <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>, <a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a> )
</span>}

<span class="comment">// Subtract a duration from an instant in time.
</span><span class="decl-fun" id="_dash_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_dash_">(-)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <a class="pp" href="#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a> (<a class="pp" href="std_time_duration-source.html#_tilde_">~<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(~): <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a><a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a>)
</span>}

<span class="comment">// Return the duration between to instants in time.
</span><span class="decl-fun" id="_dash__1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#_dash__1">(-)<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>(<span class="dash">-</span>)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#since_epoch">since-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a> <a class="pp" href="std_time_duration-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">e</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a> <a class="pp">j<span class="pc">j: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#since_epoch">since-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>
</span>}

<span class="comment">// Show an instant as a number of (TAI) SI seconds since the &#96;epoch&#96; in a given precision.
// This can be used as an unambigious time stamp.
</span><span class="decl-fun" id="show"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#show">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>show: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">max-prec<span class="pc">max<span class="dash">-</span>prec: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">9</span>, <a class="pp">secs-width<span class="pc">secs<span class="dash">-</span>width: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#use">use<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>use: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp" href="#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="#show_raw">show-raw<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>show<span class="dash">-</span>raw: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<a class="pp">max-prec<span class="pc">max<span class="dash">-</span>prec: <span class="tp">int</span></span></a>,<a class="pp">secs-width<span class="pc">secs<span class="dash">-</span>width: <span class="tp">int</span></span></a>)
</span>}

<span class="comment">// Internal: show an instant as a raw timestamp in a given precision, postfixed with the time scale name. 
</span><span class="decl-fun" id="show_raw"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#show_raw">show-raw<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>show<span class="dash">-</span>raw: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">max-prec<span class="pc">max<span class="dash">-</span>prec: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">9</span>, <a class="pp">secs-width<span class="pc">secs<span class="dash">-</span>width: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#since">since<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>since: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<a class="pp">max-prec<span class="pc">max<span class="dash">-</span>prec: <span class="tp">int</span></span></a>,<a class="pp">secs-width<span class="pc">secs<span class="dash">-</span>width: <span class="tp">int</span></span></a>) 
   <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> (<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#unit">unit<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unit: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_eq__eq__3">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="st">"TAI"</span>) <span class="kw">then</span> <span class="st">"s"</span> <span class="kw">else</span> <span class="st">""</span>)
   <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> (<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#empty_ques__1">empty?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>empty?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><a class="pp" href="std_core-source.html#_eq__eq__3">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="st">"TAI"</span>) <span class="kw">then</span> <span class="st">""</span> <span class="kw">else</span> <span class="st">" "</span> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#ts">ts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts: <span class="tp sp">(</span><span class="tp tpp">instant</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>)
</span>}

<span class="comment">/&#42;----------------------------------------------------------------------------
  Time scales
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Create a new time scale based on SI seconds (as measured on the Earth's geoid) with a given
//  &#96;name&#96;, a fixed &#96;offset&#96; (=&#96;duration0&#96;) from TAI (e.g. GPS = TAI - 19), and 
// a &#96;y2k-epoch&#96; (= &#96;timestamp0&#96;) which is the timestamp of the 2000-01-01 date in that timescale
// e.g. for a timescale &#96;ts&#96;:\
// &#96;y2k-epoch = instant(2000,1,1,cal=iso-calendar(ts)).timestamp(ts)&#96;
</span><span class="decl-fun" id="tai_timescale"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#tai_timescale">tai-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>tai<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">offset<span class="pc">offset: <span class="tp op">?</span><span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_duration-source.html#duration0">duration0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration0: <span class="tp">duration</span></span></a>, <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp op">?</span><span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">fixed</span></span></a> <span class="kw">=</span> <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_fixed-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">offset<span class="pc">offset: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
  <span class="decl-fun" id="from_tai"><span class="kw">fun</span> <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>) { <a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">fixed</span></span></a> </span>}
  <span class="decl-fun" id="to_tai"><span class="kw">fun</span> <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>)   { (<a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">fixed</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#unsafe_duration_1">unsafe-duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>duration<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a> </span>}
  <a class="pp" href="#con_space_Timescale"><span class="co">Timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">epoch<span class="dash">-</span>shift</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>in<span class="dash">-</span>day</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(
    <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>,
    <span class="st">"TAI"</span>,
    <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>,
    <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>,
    <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp">timestamp</span></span></a>,
    <a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">fixed</span></span></a>,
    <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  )
</span>}

<span class="comment">// Create a new time scale given &#96;name&#96;, two inverse function &#96;from-tai&#96; and &#96;to-tai&#96;,
// and a &#96;y2k-epoch&#96; (=&#96;timestamp0&#96;). The time unit defaults to &#96;name&#96;. 
// The &#96;y2k-epoch&#96; is the timestamp of the 2000-01-01 date in the new timescale
// e.g. for a timescale &#96;ts&#96;:\
// &#96;y2k-epoch = instant(2000,1,1,cal=iso-calendar(ts)).timestamp(ts)&#96;
</span><span class="decl-fun" id="timescale_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#timescale_1">timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>in<span class="dash">-</span>day</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, 
                      <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, 
                      <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>   <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>, 
                      <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp op">?</span><span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,
                      <a class="pp">unit<span class="pc">unit: <span class="tp op">?</span><span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>,
                      <a class="pp">secs-in-day<span class="pc">secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp op">?</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="kw">=</span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
                    ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#con_space_Timescale"><span class="co">Timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>Timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">epoch<span class="dash">-</span>shift</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>in<span class="dash">-</span>day</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(
    <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>,
    <a class="pp">unit<span class="pc">unit: <span class="tp">string</span></span></a>,
    <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>,
    <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>,
    <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp">timestamp</span></span></a>,
    <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>,
    <a class="pp">secs-in-day<span class="pc">secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span></span></a>
  )
</span>}


<span class="comment">// The [TAI](https://en.wikipedia.org/wiki/International&#95;Atomic&#95;Time) (International atomic time) 
// time scale is based on SI seconds measured on the Earth's geoid, with a 2000-01-01 TAI &#96;epoch&#96;.
</span><span class="decl-val" id="ts_tai"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_instant.html#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#tai_timescale">tai-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>tai<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"TAI"</span> </span>)

<span class="comment">// The [GPS](https://en.wikipedia.org/wiki/Global&#95;Positioning&#95;System#Timekeeping) time scale based 
// on SI seconds with a 1980-01-06 GPS epoch.\
// GPS = TAI - 19s.
</span><span class="decl-val" id="ts_gps"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_instant.html#ts_gps">ts-gps<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>gps: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#tai_timescale">tai-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>tai<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"GPS"</span>, <a class="pp" href="std_time_duration-source.html#duration_1">duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp" href="std_core-source.html#_tilde_">~<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(~): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">19</span>), <a class="pp" href="std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>seconds</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<span class="number">630720000</span>) </span>)


<span class="comment">// Return the epoch of a certain time scale.
</span><span class="decl-fun" id="timescale_epoch"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#timescale_epoch">timescale-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Return the instant of the date 2000-01-01 of a particular time scale &#96;ts&#96; (when imposed on a proleptic Gregorian calendar).\
// &#96;timescale-y2k(ts) == instant(2000,1,1,cal=iso-calendar(ts))&#96;
</span><span class="decl-fun" id="timescale_y2k"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#timescale_y2k">timescale-y2k<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale<span class="dash">-</span>y2k: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#y2k_epoch">y2k-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>y2k<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>,<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Show a time stamp with an optional maximum precision (&#96;max-prec&#96; (=&#96;9&#96;)) and 
// minimum width for the seconds (=&#96;1&#96;).
</span><span class="decl-fun" id="show_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">max-prec<span class="pc">max<span class="dash">-</span>prec: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">9</span>, <a class="pp">secs-width<span class="pc">secs<span class="dash">-</span>width: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
  <a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#ts_show">ts-show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>ts<span class="dash">-</span>show: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<a class="pp">max-prec<span class="pc">max<span class="dash">-</span>prec: <span class="tp">int</span></span></a>,<a class="pp">secs-width<span class="pc">secs<span class="dash">-</span>width: <span class="tp">int</span></span></a>)
</span>}


<span class="comment">/&#42;----------------------------------------------------------------------------
  Julian Date
----------------------------------------------------------------------------&#42;/</span>
<span class="decl-val" id="jd_epoch_delta"><span class="kw">val</span> <a class="pp" href="std_time_instant.html#jd_epoch_delta">jd-epoch-delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>delta: <span class="tp">fixed</span></span></a>  <span class="kw">=</span> <a class="pp" href="std_num_fixed-source.html#fixed">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>(<span class="number">2400000.5</span></span>)   <span class="comment">// relative to the MJD epoch 
</span><span class="decl-val" id="mjd_epoch_delta"><span class="kw">val</span> <a class="pp" href="std_time_instant.html#mjd_epoch_delta">mjd-epoch-delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>delta: <span class="tp">fixed</span></span></a> <span class="kw">=</span> <a class="pp" href="std_num_fixed-source.html#fixed_1">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>(<span class="number">51544</span></span>)       <span class="comment">// relative to our epoch (2000-01-01)
</span><span class="decl-val" id="secs_per_day"><span class="kw">val</span> <a class="pp" href="std_time_instant.html#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>    <span class="kw">=</span> <a class="pp" href="std_num_fixed-source.html#fixed_1">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>(<span class="number">86400</span></span>)

<span class="comment">// Create an instant given a [julian day](https://en.wikipedia.org/wiki/Julian&#95;day).
</span><span class="decl-fun" id="instant_at_jd"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#instant_at_jd">instant-at-jd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>at<span class="dash">-</span>jd: <span class="tp sp">(</span><span class="tp tpp">jd</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">jd<span class="pc">jd: <span class="tp">double</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a>, <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#instant_at_jd_1">instant-at-jd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>at<span class="dash">-</span>jd<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">jd</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp" href="std_num_fixed-source.html#fixed">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>(<a class="pp">jd<span class="pc">jd: <span class="tp">double</span></span></a>),<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Create an instant given a [julian day](https://en.wikipedia.org/wiki/Julian&#95;day)
// and time scale &#96;ts&#96; (=&#96;ts-utc&#96;).
</span><span class="decl-fun" id="instant_at_jd_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#instant_at_jd_1">instant-at-jd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>at<span class="dash">-</span>jd<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">jd</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">jd<span class="pc">jd: <span class="tp">fixed</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_num_fixed-source.html#type_space_fixed"><span class="tp">fixed</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed: <span class="tp">V</span></span></a>, <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#instant_at_mjd_1">instant-at-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>at<span class="dash">-</span>mjd<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">mjd</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">jd<span class="pc">jd: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#jd_epoch_delta">jd-epoch-delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>delta: <span class="tp">fixed</span></span></a>, <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> )
</span>}

<span class="comment">// Create an instant given a [modified julian day](https://en.wikipedia.org/wiki/Julian&#95;day).
// and time scale &#96;ts&#96; (=&#96;ts-utc&#96;).\
// &#96;modified-julian-day = julian-day - 2400000.5&#96;
</span><span class="decl-fun" id="instant_at_mjd"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#instant_at_mjd">instant-at-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>at<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">mjd</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">mjd<span class="pc">mjd: <span class="tp">double</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a>, <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#instant_at_mjd_1">instant-at-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>at<span class="dash">-</span>mjd<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">mjd</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp" href="std_num_fixed-source.html#fixed">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>(<a class="pp">mjd<span class="pc">mjd: <span class="tp">double</span></span></a>),<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Create an instant given a [modified julian day](https://en.wikipedia.org/wiki/Julian&#95;day).
// and time scale &#96;ts&#96; (=&#96;ts-utc&#96;).\
// &#96;modified-julian-day = julian-day - 2400000.5&#96;
</span><span class="decl-fun" id="instant_at_mjd_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#instant_at_mjd_1">instant-at-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant<span class="dash">-</span>at<span class="dash">-</span>mjd<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">mjd</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">mjd<span class="pc">mjd: <span class="tp">fixed</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_num_fixed-source.html#type_space_fixed"><span class="tp">fixed</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed: <span class="tp">V</span></span></a>, <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">d<span class="pc">d: <span class="tp">fixed</span></span></a>  <span class="kw">=</span> <a class="pp">mjd<span class="pc">mjd: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#mjd_epoch_delta">mjd-epoch-delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>delta: <span class="tp">fixed</span></span></a> <span class="comment">// since our epoch
</span>  <span class="kw">val</span> <a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#y2k_epoch">y2k-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>y2k<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> (<a class="pp">d<span class="pc">d: <span class="tp">fixed</span></span></a><a class="pp" href="std_num_fixed-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>) <span class="comment">// since the time scale epoch
</span>  <span class="kw">val</span> <a class="pp">daysecs<span class="pc">daysecs: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="#seconds_in_day">seconds-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>seconds<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a>)
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">daysecs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="std_num_fixed-source.html#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">instant</span></span></a> <a class="pp" href="#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a>,<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
  <span class="comment">// this is longer/shorter day due to leap seconds; adjust the fraction
</span>  <span class="kw">val</span> <a class="pp">days<span class="pc">days: <span class="tp">fixed</span></span></a> <span class="kw">=</span> <a class="pp">d<span class="pc">d: <span class="tp">fixed</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_fixed-source.html#trunc">trunc<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>trunc: <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_fixed-source.html#fixed_1">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>
  <span class="kw">val</span> <a class="pp">sid<span class="pc">sid: <span class="tp">fixed</span></span></a>  <span class="kw">=</span> (<a class="pp">d<span class="pc">d: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">days<span class="pc">days: <span class="tp">fixed</span></span></a>)<a class="pp" href="std_num_fixed-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a><a class="pp">daysecs<span class="pc">daysecs: <span class="tp">timespan</span></span></a>  <span class="comment">// seconds in the day
</span>  <span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">nlsecs<span class="pc">nlsecs: <span class="tp">fixed</span></span></a>,<a class="pp">lsecs<span class="pc">lsecs: <span class="tp">fixed</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">sid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_num_fixed-source.html#_gt__eq_">&gt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(&gt;=): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>)
                        <span class="kw">then</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_fixed-source.html#dec">dec<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>dec: <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>, <a class="pp">sid<span class="pc">sid: <span class="tp">fixed</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_fixed-source.html#inc">inc<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>inc: <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
                        <span class="kw">else</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">sid<span class="pc">sid: <span class="tp">fixed</span></span></a>,<a class="pp" href="std_num_fixed-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>zero: <span class="tp">fixed</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
  <span class="kw">val</span> <a class="pp">ts1<span class="pc">ts1: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#y2k_epoch">y2k-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>y2k<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> (<a class="pp">days<span class="pc">days: <span class="tp">fixed</span></span></a><a class="pp" href="std_num_fixed-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>) <a class="pp" href="std_num_fixed-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">nlsecs<span class="pc">nlsecs: <span class="tp">fixed</span></span></a>
  <span class="kw">val</span> <a class="pp">ts2<span class="pc">ts2: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp">ts1<span class="pc">ts1: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#add_leap_seconds">add-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>add<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">lsecs<span class="pc">lsecs: <span class="tp">fixed</span></span></a>)
  <a class="pp" href="#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">ts2<span class="pc">ts2: <span class="tp">timestamp</span></span></a>,<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a>) 
</span>}

<span class="comment">/&#42; Return the julian day in a given time scale &#96;ts&#96; (=&#96;ts-utc&#96;) for an instant &#96;i&#96;.
Properly takes leap seconds into account when calculating the fraction of the day 
in a UTC calendar. For example:
&#96;&#96;&#96;&#96;  
&gt; time(2014,12,31,23,59,59).jd
2457023.499988425925926

&gt; time(2015,12,31,23,59,59).jd
2457388.499988425925926

&gt; time(2016,12,31,23,59,59).jd
2457754.499976852119767

&gt; time(2016,12,31,23,59,60).jd
2457754.499988426059884
&#96;&#96;&#96;&#96;
.
&#42;/</span>
<span class="decl-fun" id="jd"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#jd">jd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>jd: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_num_fixed-source.html#type_space_fixed"><span class="tp">fixed</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#mjd">mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>mjd: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">delta</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>) <a class="pp" href="std_num_fixed-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#jd_epoch_delta">jd-epoch-delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>delta: <span class="tp">fixed</span></span></a>
</span>}

<span class="comment">// Return the modified julian day in a given time scale &#96;ts&#96; (=&#96;ts-utc&#96;) for an instant &#96;i&#96;.
// Can also pass an optional &#96;delta&#96; (=&#96;timespan0&#96;) that is added to the raw timestamp of &#96;i&#96;
// before conversion (used in &#96;std/time/time&#96; to take timezones into account)
</span><span class="decl-fun" id="mjd"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_instant.html#mjd">mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>mjd: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">delta</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>, <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a>, <a class="pp">delta<span class="pc">delta: <span class="tp op">?</span><span class="tp">timespan</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timespan0">timespan0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan0: <span class="tp">timespan</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_num_fixed-source.html#type_space_fixed"><span class="tp">fixed</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">ts0<span class="pc">ts0: <span class="tp">timestamp</span></span></a>     <span class="kw">=</span> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a>)
  <span class="kw">val</span> <a class="pp">daysecs<span class="pc">daysecs: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">ts0<span class="pc">ts0: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="#seconds_in_day">seconds-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>seconds<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a>) <span class="comment">// total-seconds in the day of the timezone (before delta)
</span>  <span class="kw">val</span> <a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a>      <span class="kw">=</span> <a class="pp">ts0<span class="pc">ts0: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">delta<span class="pc">delta: <span class="tp">timespan</span></span></a>
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">daysecs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="std_num_fixed-source.html#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>) <span class="kw">then</span> {
    <span class="comment">// without leap seconds, just divide. 
</span>    ((<a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#non_leap_seconds">non-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>non<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_fixed-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#y2k_epoch">y2k-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>y2k<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>) <a class="pp" href="std_num_fixed-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>) <a class="pp" href="std_num_fixed-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#mjd_epoch_delta">mjd-epoch-delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>delta: <span class="tp">fixed</span></span></a>
  }
  <span class="kw">else</span> {
    <span class="comment">// otherwise, divide the non-leap-seconds first, but for the seconds in the day
</span>    <span class="comment">// divide by the longer day so the day fraction is correct.
</span>    <span class="comment">// trace("mjd: day seconds: " + daysecs.show)
</span>    <span class="kw">val</span> <a class="pp">leaps<span class="pc">leaps: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#leap_seconds">leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">timestamp</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
    <span class="kw">val</span> <a class="pp">secs<span class="pc">secs: <span class="tp">fixed</span></span></a>  <span class="kw">=</span> (<a class="pp">ts<span class="pc">ts: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#non_leap_seconds">non-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>non<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_fixed-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">tscale<span class="pc">tscale: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="#y2k_epoch">y2k-epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>y2k<span class="dash">-</span>epoch: <span class="tp sp">(</span><span class="tp tpp">timescale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>)
    <span class="kw">val</span> <a class="pp">w<span class="pc">w: <span class="tp">fixed</span></span></a>     <span class="kw">=</span> (<a class="pp">secs<span class="pc">secs: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_num_fixed-source.html#floor">floor<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>floor: <span class="tp sp">(</span><span class="tp tpp">fixed</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_fixed-source.html#fixed_1">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>
    <span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">fixed</span></span></a>     <span class="kw">=</span> <a class="pp">secs<span class="pc">secs: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> (<a class="pp">w<span class="pc">w: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">fixed</span></span></a>)
    <span class="kw">val</span> <a class="pp">f<span class="pc">f: <span class="tp">fixed</span></span></a>     <span class="kw">=</span> (<a class="pp">r<span class="pc">r: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">leaps<span class="pc">leaps: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_fixed-source.html#fixed_1">fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>fixed<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a>) <a class="pp" href="std_num_fixed-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">daysecs<span class="pc">daysecs: <span class="tp">timespan</span></span></a>
    (<a class="pp">w<span class="pc">w: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp">f<span class="pc">f: <span class="tp">fixed</span></span></a> <a class="pp" href="std_num_fixed-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>fixed<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">q1</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">,</span> <span class="tp tpp">q2</span> <span class="tp kw op">:</span> <span class="tp">fixed</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fixed</span></span></a> <a class="pp" href="#mjd_epoch_delta">mjd-epoch-delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>delta: <span class="tp">fixed</span></span></a>)
  }
</span>}

</pre>

</div></body>
</html>
