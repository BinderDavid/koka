<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>utc.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;----------------------------------------------------------------------------
   Copyright (C) 2012-2016 Microsoft Corporation
    
   Licensed under the Apache License, Version 2.0 ("The Licence"). You may not
   use this file except in compliance with the License. A copy of the License
   can be found in the file "license.txt" at the root of this distribution.
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; UTC time scales and leap second support.

# UTC time calculation 

The world's civic time scale is Universal Coordinated Time ([UTC]). 
UTC is directly based on International Atomic Time ([TAI])
(&#96;ts-tai&#96;) and uses standard SI seconds. The UTC time scale differs from
TAI in that UTC stays within 1 second of [UT1](std&#95;time&#95;ut1.html); the
time scale based on the rotation of the Earth. To keep UTC close to UT1
about every 1.5 year a &#95;leap second&#95; is added to the day (appearing as
a 60th second in the last minute of the day, e.g. 23:59:60h).

In order to calculate SI second durations between time instants, we need to 
know when a leap second is inserted. For example, there was a leap second
inserted on 2017-01-01Z, so:
&#96;&#96;&#96;
time(2017,1,1,0,0,0) - time(2016,12,31,23,0,0) 
&#96;&#96;&#96;
equals 3601 SI seconds to account for the extra leap second. We also need to
know the inserted leap seconds to convert UTC time to TAI which forms the
basis of many other time scales (see [&#96;&#96;std/time/astro&#96;&#96;](std&#95;time&#95;astro.html)).

The occurrence of leap seconds cannot be reliably predicted though and
the IERS
usually [announces](https://www.iers.org/SharedDocs/News/EN/BulletinC.html)
leap seconds about half a year in advance. The [IETF leap second][ietfl]
table contains a list of all currently announced leap seconds. &#95;As such,
any future duration calculation in UTC is essentially non-deterministic since
it may be off by a number of (as yet unannounced) leap seconds&#95;. This means
in practice:

&#42; You cannot reliably tell how many SI seconds in the future a certain 
  UTC time occurs (since there may be leap seconds inserted in the future).
  If you need to store a future date, say &#96;&#96;2020-01-01T12:00:00Z&#96;&#96;, then
  store it as an ISO calendar date (&#96;:std/time/time/time&#96;), not as a time stamp.

&#42; Do not use Unix time stamps as those may be ambigious (see &#96;unix-instant&#96;); 
  this library
  already defaults to time stamps as SI seconds since &#96;epoch&#96; which are
  monotonic and unambigious. If no interaction with the user is needed, 
  consider using TAI time and calendar instead.


## Effect types and future leap seconds

Since UTC time calculations depend on a leap second table (&#96;:leaps-table&#96;),
the UTC time scale can only be created from such table (&#96;ts-utc-create&#96;).
For most precise UTC time, you can use [&#96;ts-utc-load&#96;](std&#95;time&#95;download.html#ts&#95;utc&#95;load)
to automatically download and cache the latest IERS leap second information.
This can be somewhat cumbersome though as this is a function with an &#96;:io&#96; effect.

International Time ([TI]) (or &#95;Temps International&#95;) is a proposed time scale
that matches exactly UTC up to some date but with no further leap seconds
added  after that -- which makes time calculations robust and deterministic
with regard to future dates. For this reason, this library defaults to using
TI instead of UTC. The TI time scale (&#96;ts-ti&#96;) is defined
to exactly match UTC before the compiler release date (currently 2017) but
ignores any future leap seconds.


## UTC between 1961 and 1972

UTC is only well defined after 1972-01-01Z where it got integral leap
seconds. Before 1972, the UTC time was broadcast using a combination of
fixed time steps (i.e. &#95;mini leap seconds&#95;) and an offset from the atomic
clock frequency. By adjusting the frequency, UTC time was effectively
running at a linearly adjusted rate relative to TAI. We call this
adjustment &#95;drift&#95;. For example, between 1963-11-01Z and 1964-01-01Z
the frequency offset was -130&amp;times;10^-10^ which means UTC was running
ahead of TAI by 0.0011232 seconds per day. The drift was then defined as:

&amp;quad;(TAI-UTC) = 1.9458580 + 0.0011232&amp;times;&amp;Delta;(1962-01-01) 

where the function &amp;Delta;(&#95;date&#95;) returns the number of days since
&#95;date&#95;. Therefore, the difference started as 2.6972788s (as there were
669 days between 1962-01-01 and 1963-11-01) and increased linearly up to
2.7657940s on 1964-01-01Z. For dates between 1961-01-01Z and 1972-01-01Z
the library calculates the UTC time based on the historical [USNO][dat]
drift data (see Table [#tab-utc]).

Here are some interesting time steps that occurred in this time frame: 

&#42; There was a negative time step of -0.1s inserted on 1968-02-01Z:
  &#96;&#96;&#96;
  instant(1968,1,31,23,59,59,0.9).time(cal=cal-tai) == "1968-02-01T00:00:06.185682Z TAI"
  instant(1968,2,1).time(cal=cal-tai) == "1968-02-01T00:00:06.185682Z TAI"
  &#96;&#96;&#96;
  The only other negative time step was inserted on 1961-08-01Z with a
  duration of -0.05s.

&#42; On the transition to modern UTC at 1972-01-01Z there is a mini leap second of 0.107758s.
  (because the final drift just before 1971-01-01 is 9.892242s) 
  &#96;&#96;&#96;
  instant(1972,1,1,0,0,9,0.99999999,cal=cal-tai).time.show(6) == "1971-12-31T23:59:60.107758Z" 
  instant(1972,1,1,0,0,10,cal=cal-tai).time.show == "1972-01-01T00:00:00Z" 
  &#96;&#96;&#96;

## UTC before 1961

The TAI timescale was officially established on 1958-01-01Z, and at that
time the difference (TAI - UT1) was approximately zero.
In the time frame 1958 up to 1961 the relation between TAI and UTC is not
well defined, as UTC was only officially established in 1960 (Arias
and Guinot [@Arias:utc]).

We can however use the time steps and frequency adjustments as broadcast by
the NIST WWV radio station (see Explanatory Supplement to the Astronomical
Almanac [@Almanac, pages [86--87][astroa]]).  Historically there were
18 20ms time steps from 1958. The frequency offset in the year 1958 is
not clear, and is described in the Supplement as  ".. an offset of &#95;about&#95;
-100&amp;times;10^-10^ during 1958".  We fixed the offset at -85&amp;times;10^-10^ in
order to have a zero difference from TAI at exactly 1958-01-01Z.

In the library, this makes UTC coincide with TAI up to 1958-01-01,
interpolated with 'drift' up to 1972-01-01, and using integral leap-seconds
after that.

Table [#tab-utc] shows all leap second time steps from 1958 up to 2017. This table
is calculated and uses historical data for time steps before 1972.

~ TableFigure { #tab-utc; caption:"Leap second time steps since 1958. The function \
  &amp;Delta;(&#95;date&#95;) returns the number of days since &#95;date&#95;. Entries after \
  1972 are based on [IETF data][ietfl]. The entries before 1972 are  \
  derived from the &#95;Explanatory Supplement to the Astronomical Almanac&#95;, by \
  P. Kenneth Seidelmann [@Almanac, pages [86--87][astroa]]. Entries before 1961 are based on the \
  time steps broadcast by the NIST [WWV] radio station."}

|-------------------|--------------------------|----------------|----------------|-------------------------------------------------|-----------|
| Date (UTC) &amp;quad; | Time steps &amp;quad; &amp;quad; | (TAI--UTC)     | (TAI--UTC)     | Drift                                           | &amp;quad; Frequency |
|                   |                          | Just before\ \ | On the date&amp;quad; |                                                 | Offset    |
+:------------------|--------------------------|:---------------|:---------------|-------------------------------------------------|----------:+
| 1958-01-01        | +0                       | 0              | 0              | 0.000s + 0.00073458&amp;times;&amp;Delta;(1958-01-01)       | -85&amp;times;10^-10^ |
| 1958-01-15, 19:00 | +0.020                   | 0.0108657      | 0.0308657      | 0.020s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-02-05, 19:00 | +0.020                   | 0.0462918      | 0.0662918      | 0.040s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-02-19, 19:00 | +0.020                   | 0.0765760      | 0.0965760      | 0.060s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-04-09, 19:00 | +0.020                   | 0.1325704      | 0.1525704      | 0.080s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-06-11, 19:00 | +0.020                   | 0.1988489      | 0.2188489      | 0.100s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-07-02, 19:00 | +0.020                   | 0.2342751      | 0.2542751      | 0.120s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-07-16, 19:00 | +0.020                   | 0.2645592      | 0.2845592      | 0.140s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-10-22, 19:00 | +0.020                   | 0.3565481      | 0.3765481      | 0.160s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-11-26, 19:00 | +0.020                   | 0.4022584      | 0.4222584      | 0.180s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-12-24, 19:00 | +0.020                   | 0.4428266      | 0.4628266      | 0.200s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1959-01-01        | +0                       | 0.4681217      | 0.4681220      | 0.468122s + 0.0008640&amp;times;&amp;Delta;(1959-01-01) | -100&amp;times;10^-10^ |
| 1959-01-28, 19:00 | +0.020                   | 0.4921340      | 0.5121340      | 0.488122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-02-25, 19:00 | +0.020                   | 0.5363260      | 0.5563260      | 0.508122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-04-05, 19:00 | +0.020                   | 0.5900220      | 0.6100220      | 0.528122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-08-26, 19:00 | +0.020                   | 0.7335740      | 0.7535740      | 0.548122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-09-30, 19:00 | +0.020                   | 0.7838140      | 0.8038140      | 0.568122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-11-04, 19:00 | +0.020                   | 0.8340540      | 0.8540540      | 0.588122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-11-18, 19:00 | +0.020                   | 0.8661500      | 0.8861500      | 0.608122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-12-16, 19:00 | +0.020                   | 0.9103420      | 0.9303420      | 0.628122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| \                 |                          |                |                   |                                                                 |                    |
| 1960-01-01        | +0                       | 0.9434820      | 0.9434820      | 0.943482s + 0.0012960&amp;times;&amp;Delta;(1960-01-01) | -150&amp;times;10^-10^ |
| 1961-01-01        | +0.005                   | 1.4178180      | 1.4228180      | 1.422818s + 0.0012960&amp;times;&amp;Delta;(1961-01-01) | -150&amp;times;10^-10^ |
| 1961-08-01        | --0.050                  | 1.6975700      | 1.6475700      | 1.372818s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1962-01-01        | +0                       | 1.8458580      | 1.8458580      | 1.845858s + 0.0011232&amp;times;&amp;Delta;(1962-01-01) | -130&amp;times;10^-10^ |
| 1963-11-01        | +0.100                   | 2.5972788      | 2.6972788      | 1.945858s + 0.0011232&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -130&amp;times;10^-10^ |
| 1964-01-01        | +0                       | 2.7657940      | 2.7657940      | 3.240130s + 0.0012960&amp;times;&amp;Delta;(1965-01-01) | -150&amp;times;10^-10^ |
| 1964-04-01        | +0.100                   | 2.8837300      | 2.9837300      | 3.340130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1964-09-01        | +0.100                   | 3.1820180      | 3.2820180      | 3.440130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-01-01        | +0.100                   | 3.4401300      | 3.5401300      | 3.540130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-03-01        | +0.100                   | 3.6165940      | 3.7165940      | 3.640130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-07-01        | +0.100                   | 3.8747060      | 3.9747060      | 3.740130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-09-01        | +0.100                   | 4.0550580      | 4.1550580      | 3.840130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1966-01-01        | +0                       | 4.3131700      | 4.3131700      | 4.313170s + 0.0025920&amp;times;&amp;Delta;(1966-01-01) | -300&amp;times;10^-10^ |
| 1968-02-01        | --0.100                  | 6.2856820      | 6.1856820      | 4.213170s + 0.0025920&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -300&amp;times;10^-10^ |
| \                 |                          |                |                   |                                                                 |                    |
| 1972-01-01        | +0.107758                | 9.8922420      | 10             |                                                 |            |
| 1972-07-01        | +1                       | 10             | 11             |                                                 |            |
| 1973-01-01        | +1                       | 11             | 12             |                                                 |            |
| 1974-01-01        | +1                       | 12             | 13             |                                                 |            |
| 1975-01-01        | +1                       | 13             | 14             |                                                 |            |
| 1976-01-01        | +1                       | 14             | 15             |                                                 |            |
| 1977-01-01        | +1                       | 15             | 16             |                                                 |            |
| 1978-01-01        | +1                       | 16             | 17             |                                                 |            |
| 1979-01-01        | +1                       | 17             | 18             |                                                 |            |
| 1980-01-01        | +1                       | 18             | 19             |                                                 |            |
| 1981-07-01        | +1                       | 19             | 20             |                                                 |            |
| 1982-07-01        | +1                       | 20             | 21             |                                                 |            |
| 1983-07-01        | +1                       | 21             | 22             |                                                 |            |
| 1985-07-01        | +1                       | 22             | 23             |                                                 |            |
| 1988-01-01        | +1                       | 23             | 24             |                                                 |            |
| 1990-01-01        | +1                       | 24             | 25             |                                                 |            |
| 1991-01-01        | +1                       | 25             | 26             |                                                 |            |
| 1992-07-01        | +1                       | 26             | 27             |                                                 |            |
| 1993-07-01        | +1                       | 27             | 28             |                                                 |            |
| 1994-07-01        | +1                       | 28             | 29             |                                                 |            |
| 1996-01-01        | +1                       | 29             | 30             |                                                 |            |
| 1997-07-01        | +1                       | 30             | 31             |                                                 |            |
| 1999-01-01        | +1                       | 31             | 32             |                                                 |            |
| 2006-01-01        | +1                       | 32             | 33             |                                                 |            |
| 2009-01-01        | +1                       | 33             | 34             |                                                 |            |
| 2012-07-01        | +1                       | 34             | 35             |                                                 |            |
| 2015-07-01        | +1                       | 35             | 36             |                                                 |            |
| 2017-01-01        | +1                       | 36             | 37             |                                                 |            |
|-------------------|--------------------------|----------------|----------------|-------------------------------------------------|-----------|
{white-space:nowrap; col-2-padding-left:1em; .sans-serif; }

~

-- Daan Leijen, 2016.

## References { - }

~ Bibliography { caption:"9" }

~~ BibItem { #Arias:utc; searchterm:"Arias+Coordinated+universal+time+UTC+historical+background+perspectives" }
E.F.\ Arias and B.\ Guinot.
&#95;Coordinated universal time UTC: historical background and perspectives&#95;. 
Journ&amp;eacute;es Syst&amp;egrave;mes de R&amp;eacute;f&amp;eacute;rence Spatio-Temporels. 2004.
[pdf][utchistory].
~~

~~ BibItem { #Almanac; searchterm:"Explanatory+Supplement+to+the+Astronomical+Almanac" }
P.K.\ Seidelmann.
&#95;Explanatory Supplement to the Astronomical Almanac&#95;. 
University Science Books, 1992. [pdf][astroa]
~~
~

[ietfl]: https://www.ietf.org/timezones/data/leap-seconds.list
[dat]: http://maia.usno.navy.mil/ser7/tai-utc.dat
[astroa]: https://books.google.com/books?id=uJ4JhGJANb4C&amp;lpg=PA87&amp;vq=wwv&amp;pg=PA87#v=onepage&amp;q=wwv&amp;f=false
[utchistory]: https://syrte.obspm.fr/journees2004/pdf/Arias2.pdf
[WWV]: https://www.nist.gov/time-and-frequency-services/nist-radio-stations/wwv
[UTC]: std&#95;time&#95;astro.html
[TAI]: std&#95;time&#95;astro.html
[TI]: std&#95;time&#95;astro.html
[TIpropose]: https://syrte.obspm.fr/journees2004/pdf/McCarthy2.pdf#page=4
\/
&#42;/</span>
<span class="kw">module</span> utc

<span class="kw">import</span> regex
<span class="kw">import</span> ddouble
<span class="kw">import</span> timestamp
<span class="kw">import</span> duration
<span class="kw">import</span> instant

<span class="comment">/&#42;----------------------------------------------------------------------------
  Unix
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; Given a Unix time stamp in (fractional) seconds (&#96;secs&#96;) and an optional separate 
fraction of seconds &#96;frac&#96; (for increased precision for nanosecond timestamps), return an &#96;:instant&#96;.
that is &#96;secs + frac&#96; seconds after the Unix epoch (&#96;&#96;1970-01-01Z&#96;&#96;).

Unfortunately, Unix time stamps are [ambigious](https://en.wikipedia.org/wiki/Unix&#95;time). 
The seconds &#96;secs&#96; are interpreted as: &#96;val days = secs / 86400&#96; and &#96;val dsecs = secs % 86400&#96;,
where &#96;days&#96; is the number of days since &#96;&#96;1970-01-01Z&#96;&#96; and &#96;dsecs&#96; is the SI seconds into
the day. This means that one cannot represent a possible extra leap second since it
will look as the first second of the next day. For example, here is how the time stamps look
around the leap second of &#96;&#96;1973-01-01Z&#96;&#96;:
&#96;&#96;&#96;&#96;
&gt; instant(1972,12,31,23,59,59).unix-timestamp
94694399.0

&gt; instant(1972,12,31,23,59,60).unix-timestamp
94694400.0

&gt; instant(1973,1,1).unix-timestamp
94694400.0
&#96;&#96;&#96;&#96;

Internally, this library uses proper &#96;:timestamp&#96;s that &#95;can&#95; keep track of leap seconds. 
To indicate a time in a leap second, you can use a fraction &#96;frac&#96; that is larger than &#96;1.0&#96;. For example:
&#96;&#96;&#96;&#96;
&gt; unix-instant(94694399.0).time
1972-12-31T23:59:59Z

&gt; unix-instant(94694399.0,1.0).time
1972-12-31T23:59:60Z

&gt; unix-instant(94694400.0).time
1973-01-01T00:00:00Z
&#96;&#96;&#96;&#96;

This works well for systems that support [&#96;&#96;CLOCK&#95;UTC&#96;&#96;](http://www.madore.org/~david/computers/unix-leap-seconds.html).
&#42;/</span>
<span class="decl-fun" id="unix_instant"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#unix_instant">unix-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a>, <a class="pp">frac<span class="pc">frac: <span class="tp op">?</span><span class="tp">double</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">0.0</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="std_time_instant-source.html#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp" href="std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#trunc">trunc<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trunc: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#int_2">int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fraction">fraction<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fraction: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a> <a class="pp" href="std_core-source.html#_plus__2">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a> <a class="pp">frac<span class="pc">frac: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fraction">fraction<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fraction: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>), <a class="pp">frac<span class="pc">frac: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#trunc">trunc<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trunc: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#int_2">int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>), <a class="pp" href="#ts_unix">ts-unix<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>unix: <span class="tp">timescale</span></span></a> ) 
</span>}

<span class="comment">// Get a standard Unix timestamp in fractional seconds since the Unix epoch (1970-01-01Z).
</span><span class="decl-fun" id="unix_timestamp"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#unix_timestamp">unix-timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span><a class="pp" href="std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a> {
  <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_instant-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp" href="#ts_unix">ts-unix<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>unix: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#seconds">seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#double">double<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>double: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>
</span>}

<span class="comment">/&#42;----------------------------------------------------------------------------
  Timescale creation
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Create a new time scale based on UTC seconds with a given &#96;name&#96; and a
// &#96;y2k-epoch&#96; (=&#96;timestamp0&#96;) which is the timestamp of the 2001-01-01 date in that timescale
// e.g. for a timescale &#96;ts&#96;:\
// &#96;y2k-epoch = instant-at(2000,1,1,cal=iso-calender(ts)).timestamp(ts)&#96;.
</span><span class="decl-fun" id="utc_timescale"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp op">?</span><span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan_2">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
  <span class="decl-fun" id="from_tai"><span class="kw">fun</span> <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>)  { <a class="pp" href="#tai_to_utc">tai-to-utc<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>to<span class="dash">-</span>utc: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a>) <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a> </span>}
  <span class="decl-fun" id="to_tai"><span class="kw">fun</span> <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>)     { <a class="pp" href="#utc_to_tai">utc-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">epoch-shift<span class="pc">epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>) </span>}
  <span class="decl-fun" id="secs_in_day"><span class="kw">fun</span> <a class="pp">secs-in-day<span class="pc">secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>){ <a class="pp" href="#utc_secs_in_day">utc-secs-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>) </span>}
  <a class="pp" href="std_time_instant-source.html#timescale_1">timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>in<span class="dash">-</span>day</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(
    <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>,
    <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>,
    <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>,
    <a class="pp">y2k-epoch<span class="pc">y2k<span class="dash">-</span>epoch: <span class="tp">timestamp</span></span></a>,
    <span class="st">"UTC"</span>,
    <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">secs-in-day<span class="pc">secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>)
  )
</span>}

<span class="comment">// The UTC time scale with a 2000-01-01Z UTC epoch. This uses [Unix seconds](https://en.wikipedia.org/wiki/Unix&#95;time)
// but in contrast to Unix time stamps the library will accurately maintain any leap second information
// (through &#96;:timestamp&#96;s). 
</span><span class="decl-fun" id="ts_utc_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#ts_utc_create">ts-utc-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>utc<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"UTC"</span>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> )
</span>}

<span class="comment">// [Unix](https://en.wikipedia.org/wiki/Unix&#95;time) time scale based on Unix seconds but with 1970-01-01 epoch.
</span><span class="decl-fun" id="ts_unix_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#ts_unix_create">ts-unix-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>unix<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"UNIX"</span>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp" href="std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<span class="number">946684800</span>) )
</span>}

<span class="comment">// [NTP](https://en.wikipedia.org/wiki/Network&#95;Time&#95;Protocol) time scale is equal to the UTC time scale (&#96;ts-utc&#96;) but 
// with a 1900-01-01Z epoch.
</span><span class="decl-fun" id="ts_ntp_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#ts_ntp_create">ts-ntp-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ntp<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"NTP"</span>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp" href="std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<span class="number">3155673600</span>) )
</span>}

<span class="comment">/&#42; The [TI] (&#95;International Time&#95;) time scale with a 2000-01-01Z UTC epoch. 
This is the default time scale used in this library. It was a
[proposed][TIpropose] time scale at the 2004 ITU-R meeting as a replacement of UTC
without future leap seconds. In this library, we define TI to match
exactly UTC up to the compiler release date (currently 2017) but ignore any
possible future leap seconds after that date. This is the preferred time scale
in this library as it guarantees deterministic time calculations for any
future date, i.e. before 2017-01-01Z, TI == UTC, while after that, TI == TAI - 37s.
&#42;/</span>
<span class="decl-val" id="ts_ti"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_utc.html#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"TI"</span>, <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> </span>)

<span class="comment">// [Unix](https://en.wikipedia.org/wiki/Unix&#95;time) time scale based on Unix seconds. 
// It equals the &#96;ts-ti&#96; time scale except with a 1970-01-01 epoch.
</span><span class="decl-val" id="ts_unix"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_utc.html#ts_unix">ts-unix<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>unix: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_unix_create">ts-unix-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>unix<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> </span>)


<span class="comment">// Standard seconds per day (=&#96;86400&#96;). Note that a UTC day can contain extra leap seconds.
</span><span class="decl-val" id="secs_per_day"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<span class="number">86400</span></span>)

<span class="comment">// -----------------------------------------------------------
// UTC calendar leap second calculation
//
// Since the timescales &#96;tai&#96; and &#96;utc&#96; refer to &#96;utc-from-tai&#96;
// and &#96;tai-from-utc&#96; these routines strictly work in durations
// and cannot refer to instants or otherwise the definitions become
// mutually recursive.
// -----------------------------------------------------------
</span>

<span class="comment">// &#96;:utc-timestamp&#96; is an alias used for timestamp's in UTC seconds.
</span><span class="decl-alias" id="type_space_utc_timestamp"><span class="tp kw">alias</span> <a class="pp" href="std_time_utc.html#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> <span class="tp kw">=</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a></span>


<span class="comment">// A leap second table describes when UTC leap seconds occur.
</span><span class="decl-type" id="type_space_leaps_table"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Leaps_table"><a class="pp" href="std_time_utc.html#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>(
  <span class="kw">public</span> <span class="decl-fun" id="expire"><a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>,       
  <span class="decl-fun" id="adjusts"><a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a></span><span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="comment">// Each entry gives the start instant and integer leap second adjustment.
</span></span></span>)

<span class="comment">// Leap second adjustments. For an instant &#96;i&#96; after &#96;start&#96;:\
// &#96;&#96;TAI-offset = offset + (delta &#42; days(i - delta-start))&#96;&#96;
</span><span class="decl-type" id="type_space_leap_adjust"><span class="tp kw">struct</span> <span class="decl-con" id="con_space_Leap_adjust"><a class="pp" href="std_time_utc.html#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a>(
  <span class="decl-fun" id="utc_start"><a class="pp">utc-start<span class="pc">utc<span class="dash">-</span>start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a></span>  <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a>,  <span class="comment">// start time in UTC seconds since 1972-01-01Z
</span>  <span class="decl-fun" id="offset"><a class="pp">offset<span class="pc">offset: <span class="tp">timespan</span></span></a></span>     <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>,       <span class="comment">// base offset
</span>  <span class="decl-fun" id="delta_start"><a class="pp">delta-start<span class="pc">delta<span class="dash">-</span>start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a></span><span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a>  <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,   <span class="comment">// start of delta adjustment
</span>  <span class="decl-fun" id="delta"><a class="pp">delta<span class="pc">delta: <span class="tp">ddouble</span></span></a></span>      <span class="tp kw op">:</span> <a class="pp" href="std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a>   
</span></span>)

<span class="decl-val" id="leaps_table0"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#leaps_table0">leaps-table0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table0: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Leaps_table"><span class="co">Leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leaps<span class="dash">-</span>table: <span class="tp sp">(</span><span class="tp tpp">expire</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp" href="std_time_instant-source.html#epoch">epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>epoch: <span class="tp">instant</span></span></a>,<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a></span>)
<span class="decl-val" id="zero"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Leap_adjust"><span class="co">Leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">delta<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">delta</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,<a class="pp" href="std_time_timestamp-source.html#timespan0">timespan0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan0: <span class="tp">timespan</span></span></a>,<a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,<a class="pp" href="std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a></span>)

<span class="decl-fun" id="zero_ques_"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#zero_ques_">zero?<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero?: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#zero_ques_">zero?<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero?: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#delta">delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#zero_ques_">zero?<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero?: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
</span>}

<span class="comment">// Get the leap-second adjustment
</span><span class="decl-fun" id="tai_offset"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>( <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a>, <a class="pp">utc-i<span class="pc">utc<span class="dash">-</span>i: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#delta">delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#zero_ques_">zero?<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero?: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <span class="kw">else</span> {
    <span class="comment">// pre 1972 is a rubber leap second
</span>    <span class="kw">val</span> <a class="pp">days<span class="pc">days: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#div">div<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>div: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>((<a class="pp">utc-i<span class="pc">utc<span class="dash">-</span>i: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan_2">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#delta_start">delta-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan_2">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>), <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>, <span class="number">3</span>) 
    <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> (<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#delta">delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">days<span class="pc">days: <span class="tp">ddouble</span></span></a>)
  }
</span>}


<span class="comment">// Default TI leaps table has leap second information up to the compiler release (currently &#96;leaps-table-y2017&#96;).
</span><span class="decl-val" id="leaps_table_ti"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_utc.html#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#parse_leaps_table">parse-leaps-table<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leaps<span class="dash">-</span>table: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="#default_ietf_leap_seconds">default-ietf-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>default<span class="dash">-</span>ietf<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp">string</span></span></a> )<span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="#leaps_table0">leaps-table0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table0: <span class="tp">leaps<span class="dash">-</span>table</span></span></a></span>)

<span class="comment">// Leap second table up to 2017-01-01Z.
</span><span class="decl-val" id="leaps_table_y2017"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_utc.html#leaps_table_y2017">leaps-table-y2017<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>y2017: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#upto">upto<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>upto: <span class="tp sp">(</span><span class="tp tpp">lt</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<span class="number">536544000</span><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a></span>)  <span class="comment">// == instant(2017,1,1).timestamp(ts-ti)
</span>
<span class="decl-fun" id="upto"><span class="kw">private</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#upto">upto<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>upto: <span class="tp sp">(</span><span class="tp tpp">lt</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( <a class="pp">lt<span class="pc">lt: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">end<span class="pc">end: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> {
  <a class="pp">lt<span class="pc">lt: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( adjusts <span class="kw">=</span> <a class="pp">lt<span class="pc">lt: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#drop_while">drop-while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>drop<span class="dash">-</span>while: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="kw">fun</span>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>) { <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">end<span class="pc">end: <span class="tp">timestamp</span></span></a> }),
      expire  <span class="kw">=</span> <a class="pp" href="std_time_instant-source.html#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">end<span class="pc">end: <span class="tp">timestamp</span></span></a>,<a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a>))
</span>}


<span class="comment">// Get a list of leap second steps in a triple, UTC time, offset just before, and the new offset at that time,
// the base offset, the delta start date and the delta rate.
</span><span class="decl-fun" id="get_leap_steps"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#get_leap_steps">get-leap-steps<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>get<span class="dash">-</span>leap<span class="dash">-</span>steps: <span class="tp sp">(</span><span class="tp tpp">table</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">ddouble</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">table<span class="pc">table: <span class="tp op">?</span><span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__comma__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space__lp__comma__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__comma__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">val</span> <a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">table<span class="pc">table: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#reverse">reverse<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  <a class="pp" href="std_core-source.html#zip">zip<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>zip: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>),<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a>) {
    <span class="kw">val</span> <a class="pp">ts<span class="pc">ts: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="kw">=</span> <a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>
    <span class="kw">val</span> <a class="pp">ofs1<span class="pc">ofs1: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a><span class="kw op">.</span><a class="pp" href="#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
    <span class="kw">val</span> <a class="pp">ofs2<span class="pc">ofs2: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
    <a class="pp" href="std_core-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a><a class="pp">ts<span class="pc">ts: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>,<a class="pp">ofs1<span class="pc">ofs1: <span class="tp">timespan</span></span></a>,<a class="pp">ofs2<span class="pc">ofs2: <span class="tp">timespan</span></span></a>,<a class="pp" href="std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>,<a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#delta_start">delta-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>,<a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#delta">delta<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a>
  })
</span>}


<span class="comment">/&#42;----------------------------------------------------------------------------
  UTC-SLS: smoothed leap seconds
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// TI time scale with smoothed leap seconds.\
// Implements a TI time scale (&#96;ts-ti&#96;) except without ever showing leap seconds.
// TI-SLS is equivalent to TI except for the last 1000 seconds of a day where
// a leap second occurs. On such day, the leap second time step (positive or negative)
// is distributed over the last 1000 seconds of the day. On the full hour, TI
// and TI-SLS are equal again. 
</span><span class="decl-val" id="ts_ti_sls"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_utc.html#ts_ti_sls">ts-ti-sls<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti<span class="dash">-</span>sls: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_sls_create">utc-sls-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"TI-SLS"</span>, <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> </span>)


<span class="comment">// Create a new UTC-SLS time scale from a provided leap second table &#96;leaps&#96;.
// Implements a UTC time scale except without ever showing leap seconds.
// UTC-SLS is equivalent to UTC except for the last 1000 seconds of a day where
// a leap second occurs. On such day, the leap second time step (positive or negative)
// is distributed over the last 1000 seconds of the day. On the full hour, UTC
// and UTC-SLS are equal again. 
//
// This is a recommended time scale to use for
// time stamps or communication with other services since it avoids any potential trouble
// with leap seconds while still being quite precise.
// See also: &lt;https://www.cl.cam.ac.uk/~mgk25/time/utc-sls&gt;.
//
// You can create a UTC-SLS time scale based on the latest IETF leap second
// data using [&#96;cal-utc-sls-load&#96;](std&#95;time&#95;download.html#cal&#95;utc&#95;sls&#95;load).
</span><span class="decl-fun" id="ts_utc_sls_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#ts_utc_sls_create">ts-utc-sls-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>utc<span class="dash">-</span>sls<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_sls_create">utc-sls-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"UTC-SLS"</span>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> )
</span>}

<span class="comment">// Create a new smooted leap second time scale with an optional period during
// which smoothing takes place. This is 1000s for &#96;ts-utc-sls&#96;.
</span><span class="decl-fun" id="utc_sls_create"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#utc_sls_create">utc-sls-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp op">?</span><span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1000</span><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#seconds_1">seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>seconds<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">sp<span class="pc">sp: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#seconds">seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>seconds: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
  <a class="pp" href="std_time_instant-source.html#timescale_1">timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">y2k<span class="dash">-</span>epoch</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>in<span class="dash">-</span>day</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(
    <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>,
    <span class="kw">fun</span>(<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>) { <a class="pp" href="#tai_to_utc_sls">tai-to-utc-sls<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>to<span class="dash">-</span>utc<span class="dash">-</span>sls: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a>, <a class="pp">sp<span class="pc">sp: <span class="tp">timespan</span></span></a>) },
    <span class="kw">fun</span>(<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>) { <a class="pp" href="#utc_sls_to_tai">utc-sls-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>, <a class="pp">sp<span class="pc">sp: <span class="tp">timespan</span></span></a>) },
    <a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,
    <span class="st">"UTC-SLS"</span>,
    <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  )
</span>}

<span class="decl-fun" id="utc_sls_to_tai"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#utc_sls_to_tai">utc-sls-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a>,<a class="pp">mbsmooth<span class="pc">mbsmooth: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="#find_utc_smooth">find-utc-smooth<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>utc<span class="dash">-</span>smooth: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>, <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a>) 
  <span class="comment">// convert directly to tai as we have all info
</span>  <span class="kw">match</span>(<a class="pp">mbsmooth<span class="pc">mbsmooth: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) { 
    <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> {
      <a class="pp" href="std_time_duration-source.html#unsafe_duration_1">unsafe-duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>duration<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a> )
    }
    <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">step<span class="pc">step: <span class="tp">timespan</span></span></a>,<a class="pp">start<span class="pc">start: <span class="tp">timespan</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>) <span class="kw op">-></span> {
      <a class="pp" href="std_time_duration-source.html#unsafe_duration">unsafe-duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>duration: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp" href="std_time_timestamp-source.html#div">div<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>div: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>( <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> (<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan_2">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timespan</span></span></a>), (<span class="number">1</span><span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#ddouble_1">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="std_time_timestamp-source.html#div">div<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>div: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<a class="pp">step<span class="pc">step: <span class="tp">timespan</span></span></a>,<a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a>)) ) )
    }
  }
</span>}

<span class="decl-fun" id="tai_to_utc_sls"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#tai_to_utc_sls">tai-to-utc-sls<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>to<span class="dash">-</span>utc<span class="dash">-</span>sls: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span><a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>, <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp" href="#tai_to_utc">tai-to-utc<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>to<span class="dash">-</span>utc: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a>)
  <span class="kw">val</span> <a class="pp">tsls<span class="pc">tsls: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <span class="kw">match</span>(<a class="pp" href="#find_utc_smooth">find-utc-smooth<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>utc<span class="dash">-</span>smooth: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>, <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a>) {
    <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>
    <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">step<span class="pc">step: <span class="tp">timespan</span></span></a>,<a class="pp">start<span class="pc">start: <span class="tp">timespan</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>) <span class="kw op">-></span> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">step<span class="pc">step: <span class="tp">timespan</span></span></a><a class="pp" href="std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<a class="pp" href="std_time_timestamp-source.html#div">div<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>div: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan_2">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timespan</span></span></a>, <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a>))
  }
  <a class="pp" href="std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tsls<span class="pc">tsls: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#seconds">seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>) <span class="comment">// remove leap seconds
</span></span>}


<span class="decl-fun" id="find_utc_smooth"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#find_utc_smooth">find-utc-smooth<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>utc<span class="dash">-</span>smooth: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">smooth<span class="dash">-</span>period</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">t</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#utc1958">utc1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc1958: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>,<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>

  <span class="kw">match</span>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#find_adjust">find-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">previous</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>)) {
    <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ladj<span class="pc">ladj: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">next<span class="pc">next: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>) <span class="kw op">-></span> {
      <span class="kw">val</span> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a>   <span class="kw">=</span> <a class="pp">ladj<span class="pc">ladj: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>)
      <span class="kw">val</span> <a class="pp">step<span class="pc">step: <span class="tp">ddouble</span></span></a>  <span class="kw">=</span> <a class="pp">next<span class="pc">next: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">next<span class="pc">next: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>) <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a>
      <span class="kw">val</span> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp">next<span class="pc">next: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">step<span class="pc">step: <span class="tp">ddouble</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">smooth-period<span class="pc">smooth<span class="dash">-</span>period: <span class="tp">ddouble</span></span></a>
      <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a>, <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">next</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#zero_ques_">zero?<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero?: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw">else</span> <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">step<span class="pc">step: <span class="tp">ddouble</span></span></a>,<a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan_2">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>)<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
    }
    <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>,<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
  } 
</span>}

<span class="decl-fun" id="find_adjust"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#find_adjust">find-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">previous</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">previous<span class="pc">previous: <span class="tp op">?</span><span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">match</span>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">earlier<span class="pc">earlier: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
      <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>) 
       <span class="kw">then</span> <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">previous<span class="pc">previous: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>)
       <span class="kw">else</span> <a class="pp" href="#find_adjust">find-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">previous</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">earlier<span class="pc">earlier: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>, <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>)
    }
  }
</span>}



<span class="comment">/&#42;----------------------------------------------------------------------------
  UTC to TAI conversion
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Convert a UTC duration since &#96;epoch&#96; to a TAI duration since &#96;epoch&#96;.
</span><span class="decl-fun" id="utc_to_tai"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#utc_to_tai">utc-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_to_tai_stamp">utc-to-tai-stamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>tai<span class="dash">-</span>stamp: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> )<span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#unsafe_duration_1">unsafe-duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>duration<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>
</span>}

<span class="decl-fun" id="utc_to_tai_stamp"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#utc_to_tai_stamp">utc-to-tai-stamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>tai<span class="dash">-</span>stamp: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">t</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#utc1958">utc1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc1958: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">timestamp</span></span></a> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>
  <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#find_maybe">find-maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>find<span class="dash">-</span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<span class="kw">fun</span>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>) {
    <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw">else</span> {
      <span class="kw">val</span> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>)
      <span class="comment">// trace("found: " + t.show + " &gt;= " + la.utc-start.show + ", ofs:" + ofs.show)
</span>      <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( (<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a>) )
    }
  })<span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>)  
</span>}

<span class="comment">// Convert a TAI duration since &#96;epoch&#96; to a UTC duration since &#96;epoch&#96;.
</span><span class="decl-fun" id="tai_to_utc"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#tai_to_utc">tai-to-utc<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>to<span class="dash">-</span>utc: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <span class="comment">//trace("utc-from-tai: " + i.show)
</span>  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">d</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#tai1958">tai1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai1958: <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <span class="kw">else</span> <a class="pp" href="#find_utc_from_tai">find-utc-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>utc<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">d<span class="pc">d: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> )
</span>}
<span class="decl-val" id="tai1958"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#tai1958">tai1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai1958: <span class="tp">duration</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_duration-source.html#duration_1">duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp" href="std_core-source.html#_tilde_">~<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(~): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">1325376000</span></span>)  <span class="comment">// 1958-01-01Z in seconds since epoch
</span><span class="decl-val" id="utc1958"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#utc1958">utc1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc1958: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp" href="#tai1958">tai1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai1958: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a></span>

<span class="decl-fun" id="find_utc_from_tai"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#find_utc_from_tai">find-utc-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>utc<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <span class="kw">match</span>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a> <span class="comment">// should never happen
</span>    <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">earlier<span class="pc">earlier: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
      <span class="kw">val</span> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a>   <span class="kw">=</span> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a>)
      <span class="kw">val</span> <a class="pp">utc-i<span class="pc">utc<span class="dash">-</span>i: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a>
      <span class="kw">val</span> <a class="pp">max<span class="pc">max: <span class="tp">timestamp</span></span></a>   <span class="kw">=</span> <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">ofs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#neg_ques_">neg?<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>neg?: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp">utc-i<span class="pc">utc<span class="dash">-</span>i: <span class="tp">timestamp</span></span></a> <span class="kw">else</span> <a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a>
      <span class="comment">// trace("check: utc-i: " + utc-i.show + ", start: " + la.utc-start.show + ", ofs: " + ofs.show + ", i: " + i.show)
</span>      <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">max<span class="pc">max: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp" href="#find_utc_from_tai">find-utc-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>utc<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a>,<a class="pp">earlier<span class="pc">earlier: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) <span class="kw">else</span> {
        <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">utc-i<span class="pc">utc<span class="dash">-</span>i: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> {
          <span class="comment">// in the time frame
</span>          <span class="comment">// trace(" utc-from-tai: found: utc: " + utc-i.show + ", tai-ofs: " + ofs.ts-show )
</span>          <a class="pp">utc-i<span class="pc">utc<span class="dash">-</span>i: <span class="tp">timestamp</span></span></a>
        }
        <span class="kw">else</span> {
          <span class="comment">// leap-second crosses-over into other time frame            
</span>          <span class="comment">// get adjustment using the earlier frame too
</span>          <span class="comment">// trace("found crossover: " + utc-i.show + ", ofs: " + ofs.ts-show + ", i: " + i.show )
</span>          <span class="kw">val</span> <a class="pp">la-before<span class="pc">la<span class="dash">-</span>before: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="kw">=</span> <a class="pp">earlier<span class="pc">earlier: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#head_1">head<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>head<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>)
          <span class="kw">val</span> <a class="pp">ofs-before<span class="pc">ofs<span class="dash">-</span>before: <span class="tp">timespan</span></span></a><span class="kw">=</span> <a class="pp">la-before<span class="pc">la<span class="dash">-</span>before: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#tai_offset">tai-offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>tai<span class="dash">-</span>offset: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc<span class="dash">-</span>i</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a>)
          <span class="kw">val</span> <a class="pp">utc-prev<span class="pc">utc<span class="dash">-</span>prev: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp">i<span class="pc">i: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">ofs-before<span class="pc">ofs<span class="dash">-</span>before: <span class="tp">timespan</span></span></a>
          <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">utc-prev<span class="pc">utc<span class="dash">-</span>prev: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> {
            <span class="comment">// use previous leap-second offset            
</span>            <span class="comment">// trace(" use previous: " + utc-prev.show + ", ofs-before: " + ofs-before.ts-show )
</span>            <a class="pp">utc-prev<span class="pc">utc<span class="dash">-</span>prev: <span class="tp">timestamp</span></span></a>
          }
          <span class="kw">else</span> {
            <span class="comment">// this is inside an added leap-second, use &#96;add-leap-seconds&#96;.
</span>            <span class="kw">val</span> <a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a>     <span class="kw">=</span> <a class="pp">ofs<span class="pc">ofs: <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">ofs-before<span class="pc">ofs<span class="dash">-</span>before: <span class="tp">timespan</span></span></a>
            <span class="kw">val</span> <a class="pp">utc-leap<span class="pc">utc<span class="dash">-</span>leap: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp">utc-i<span class="pc">utc<span class="dash">-</span>i: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#adjust_leap_seconds">adjust-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>adjust<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a>)                            
            <span class="comment">// trace(" in a leap second: " + utc-leap.show + ", diff: " + diff.ts-show + ", ofs: " + ofs.ts-show + ", ofs-before: " + ofs-before.ts-show )
</span>            <a class="pp">utc-leap<span class="pc">utc<span class="dash">-</span>leap: <span class="tp">timestamp</span></span></a>
          }
        }
      }  
    }
  }
</span>}


<span class="comment">// Return the SI seconds in the day of time &#96;t&#96; (as a UTC timestamp)
</span><span class="decl-fun" id="utc_secs_in_day"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#utc_secs_in_day">utc-secs-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> {
  <span class="comment">//trace("search nlsecs: " + nlsecs.ts-show)
</span>  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">t</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#utc1972">utc1972<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc1972: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">timespan</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>
  <span class="kw">match</span>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#long_day_ques_">long-day?<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>long<span class="dash">-</span>day?: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>)) {
    <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leap-secs<span class="pc">leap<span class="dash">-</span>secs: <span class="tp">ddouble</span></span></a>) <span class="kw op">-></span> <a class="pp">leap-secs<span class="pc">leap<span class="dash">-</span>secs: <span class="tp">ddouble</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>
    &#95; <span class="kw op">-></span> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>
  }
</span>}
<span class="decl-val" id="utc1972"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#utc1972">utc1972<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc1972: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp" href="std_core-source.html#_tilde_">~<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(~): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">883612800</span></span>)  <span class="comment">// instant-at(1972).timestamp(ts-utc)
</span>
<span class="decl-fun" id="long_day_ques_"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#long_day_ques_">long-day?<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>long<span class="dash">-</span>day?: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">match</span>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">rest<span class="pc">rest: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
      <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="#long_day_ques_">long-day?<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>long<span class="dash">-</span>day?: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">rest<span class="pc">rest: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a> 
      <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">la</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">t<span class="pc">t: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>  
      <span class="kw">val</span> <a class="pp">delta<span class="pc">delta: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <span class="kw">match</span>(<a class="pp">rest<span class="pc">rest: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) {
        <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <span class="number">1</span><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
        <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">la-before<span class="pc">la<span class="dash">-</span>before: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>) <span class="kw op">-></span> (<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">la-before<span class="pc">la<span class="dash">-</span>before: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>)
      }
      <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">delta<span class="pc">delta: <span class="tp">timespan</span></span></a>)
    }
  }
</span>}



<span class="comment">// -----------------------------------------------------------
// Parsing UTC leap second tables
// -----------------------------------------------------------
</span>
<span class="decl-val" id="ntp_shift"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#ntp_shift">ntp-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp<span class="dash">-</span>shift: <span class="tp">int</span></span></a> <span class="kw">=</span> <span class="number">3155673600</span></span>  <span class="comment">// 2000-01-01 TAI - 1900-01-01 TAI in seconds; = (100&#42;365 + 24)&#42;(24&#42;3600)  (24 leap days)
</span>

<span class="comment">// Parse a leap second table from text &#96;leaps&#96; in the  [IETF leap second](https://www.ietf.org/timezones/data/leap-seconds.list) 
// file format. Returns a full leap second table extended with historical leap second adjustments from before 1972.
</span><span class="decl-fun" id="parse_leaps_table"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_utc.html#parse_leaps_table">parse-leaps-table<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leaps<span class="dash">-</span>table: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="comment">// get leap second adjustments
</span>  <span class="kw">val</span> <a class="pp">adjusts72<span class="pc">adjusts72: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#find_all">find-all<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>find<span class="dash">-</span>all: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">regex</span> <span class="tp kw op">:</span> <span class="tp">regex</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">matched</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#rxleap">rxleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>rxleap: <span class="tp">regex</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a> <span class="kw">fun</span>(<a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a>) {
    <span class="kw">val</span> <a class="pp">ntpsecs<span class="pc">ntpsecs: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#groups">groups<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>groups: <span class="tp sp">(</span><span class="tp tpp">matched</span> <span class="tp kw op">:</span> <span class="tp">matched</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">groups</span></span></a><a class="pp" href="std_text_regex-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>[]: <span class="tp sp">(</span><span class="tp tpp">groups</span> <span class="tp kw op">:</span> <span class="tp">groups</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="number">1</span>]<span class="kw op">.</span><a class="pp" href="std_core-source.html#parse_int_default">parse-int-default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>parse<span class="dash">-</span>int<span class="dash">-</span>default: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">hex</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp" href="#ntp_shift">ntp-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp<span class="dash">-</span>shift: <span class="tp">int</span></span></a>)   
    <span class="kw">val</span> <a class="pp">adjust<span class="pc">adjust: <span class="tp">int</span></span></a>  <span class="kw">=</span> <a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#groups">groups<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>groups: <span class="tp sp">(</span><span class="tp tpp">matched</span> <span class="tp kw op">:</span> <span class="tp">matched</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">groups</span></span></a><a class="pp" href="std_text_regex-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>[]: <span class="tp sp">(</span><span class="tp tpp">groups</span> <span class="tp kw op">:</span> <span class="tp">groups</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="number">2</span>]<span class="kw op">.</span><a class="pp" href="std_core-source.html#parse_int_default">parse-int-default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>parse<span class="dash">-</span>int<span class="dash">-</span>default: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">hex</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<span class="number">0</span>)
    <span class="comment">// trace("leap entry: " + adjust.show + " - " + ntpsecs.show )
</span>    <a class="pp" href="#con_space_Leap_adjust"><span class="co">Leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">delta<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">delta</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp" href="std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ntpsecs<span class="pc">ntpsecs: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="#ntp_shift">ntp-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp<span class="dash">-</span>shift: <span class="tp">int</span></span></a>), <a class="pp">adjust<span class="pc">adjust: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>, <a class="pp" href="std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>)
  }<span class="kw op">.</span><a class="pp" href="std_core-source.html#reverse">reverse<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>

  <span class="comment">// get expiration date
</span>  <span class="kw">val</span> <a class="pp">la-final<span class="pc">la<span class="dash">-</span>final: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>   <span class="kw">=</span> <a class="pp">adjusts72<span class="pc">adjusts72: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#head_1">head<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>head<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>)
  <span class="kw">val</span> <a class="pp">utc-expire<span class="pc">utc<span class="dash">-</span>expire: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#find">find<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>find: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">regex</span> <span class="tp kw op">:</span> <span class="tp">regex</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">matched</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#rxexpire">rxexpire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>rxexpire: <span class="tp">regex</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#map">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a> <span class="kw">fun</span>(<a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a>) {
    <span class="kw">val</span> <a class="pp">ntpex<span class="pc">ntpex: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#groups">groups<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>groups: <span class="tp sp">(</span><span class="tp tpp">matched</span> <span class="tp kw op">:</span> <span class="tp">matched</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">groups</span></span></a><a class="pp" href="std_text_regex-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>[]: <span class="tp sp">(</span><span class="tp tpp">groups</span> <span class="tp kw op">:</span> <span class="tp">groups</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="number">1</span>]<span class="kw op">.</span><a class="pp" href="std_core-source.html#parse_int_default">parse-int-default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>parse<span class="dash">-</span>int<span class="dash">-</span>default: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">hex</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp" href="#ntp_shift">ntp-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp<span class="dash">-</span>shift: <span class="tp">int</span></span></a>)
    <a class="pp" href="std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ntpex<span class="pc">ntpex: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="#ntp_shift">ntp-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp<span class="dash">-</span>shift: <span class="tp">int</span></span></a>)
  }<span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp">la-final<span class="pc">la<span class="dash">-</span>final: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> (<span class="number">182</span><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a><a class="pp" href="std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>))  <span class="comment">// default: 6 months after last leap second
</span>  <span class="comment">// trace("expire: " + utc-expire.ts-show)
</span>  <span class="kw">val</span> <a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_instant-source.html#unsafe_instant">unsafe-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">utc-expire<span class="pc">utc<span class="dash">-</span>expire: <span class="tp">timestamp</span></span></a> <a class="pp" href="std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">la-final<span class="pc">la<span class="dash">-</span>final: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>, <a class="pp" href="std_time_instant-source.html#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a> ) <span class="comment">// interpret as TAI to avoid recursion..
</span>
  <span class="kw">val</span> <a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">adjusts72<span class="pc">adjusts72: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="#leap_seconds_pre72">leap-seconds-pre72<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>seconds<span class="dash">-</span>pre72: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>()  <span class="comment">// add pre 1972 adjustments
</span>  <span class="kw">val</span> <a class="pp">table<span class="pc">table: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Leaps_table"><span class="co">Leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leaps<span class="dash">-</span>table: <span class="tp sp">(</span><span class="tp tpp">expire</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a>,<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)
  <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">table<span class="pc">table: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>)
</span>}
<span class="decl-val" id="rxleap"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#rxleap">rxleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>rxleap: <span class="tp">regex</span></span></a>   <span class="kw">=</span> <a class="pp" href="std_text_regex-source.html#regex">regex<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>regex: <span class="tp sp">(</span><span class="tp tpp">regex</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ignorecase</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">multiline</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">regex</span></span></a>(<span class="st">"^[ \\t]&#42;(\\d+)[ \\t]+(\\d+)[ \\t]&#42;(?:#.&#42;)?$"</span>,multiLine<span class="kw">=</span><a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a></span>)
<span class="decl-val" id="rxexpire"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#rxexpire">rxexpire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>rxexpire: <span class="tp">regex</span></span></a> <span class="kw">=</span> <a class="pp" href="std_text_regex-source.html#regex">regex<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>regex: <span class="tp sp">(</span><span class="tp tpp">regex</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ignorecase</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">multiline</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">regex</span></span></a>(<span class="st">"^[ \\t]&#42;#@[ \\t]&#42;(\\d+)[ \\t]&#42;(?:#.&#42;)?$"</span>, multiLine<span class="kw">=</span><a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a></span>)

<span class="comment">// IETF leap second data valid until 2017-06-28
</span><span class="decl-val" id="default_ietf_leap_seconds"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#default_ietf_leap_seconds">default-ietf-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>default<span class="dash">-</span>ietf<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp">string</span></span></a> <span class="kw">=</span> <span class="st">"\n  # From: https://www.ietf.org/timezones/data/leap-seconds.list\n  # Updated through IERS Bulletin C52\n  # File expires on:  28 June 2017\n  #\n  #@  3707596800\n  #\n  2272060800  10  # 1 Jan 1972\n  2287785600  11  # 1 Jul 1972\n  2303683200  12  # 1 Jan 1973\n  2335219200  13  # 1 Jan 1974\n  2366755200  14  # 1 Jan 1975\n  2398291200  15  # 1 Jan 1976\n  2429913600  16  # 1 Jan 1977\n  2461449600  17  # 1 Jan 1978\n  2492985600  18  # 1 Jan 1979\n  2524521600  19  # 1 Jan 1980\n  2571782400  20  # 1 Jul 1981\n  2603318400  21  # 1 Jul 1982\n  2634854400  22  # 1 Jul 1983\n  2698012800  23  # 1 Jul 1985\n  2776982400  24  # 1 Jan 1988\n  2840140800  25  # 1 Jan 1990\n  2871676800  26  # 1 Jan 1991\n  2918937600  27  # 1 Jul 1992\n  2950473600  28  # 1 Jul 1993\n  2982009600  29  # 1 Jul 1994\n  3029443200  30  # 1 Jan 1996\n  3076704000  31  # 1 Jul 1997\n  3124137600  32  # 1 Jan 1999\n  3345062400  33  # 1 Jan 2006\n  3439756800  34  # 1 Jan 2009\n  3550089600  35  # 1 Jul 2012\n  3644697600  36  # 1 Jul 2015\n  3692217600  37  # 1 Jan 2017"</span></span>
  <span class="comment">// 3723753600  35  # 1 Jan 2018" //testing negative 2 seconds
</span>
<span class="comment">// -----------------------------------------------------------
// Parsing TAI 'continuous' leap second tables from before 1972
// -----------------------------------------------------------
</span>
<span class="comment">// Cached leap second table for dates before 1972.
</span><span class="decl-val" id="leap_seconds_pre72"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#leap_seconds_pre72">leap-seconds-pre72<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>seconds<span class="dash">-</span>pre72: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="kw">=</span> <a class="pp" href="std_core-source.html#once">once<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>once: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">calc</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>{ <a class="pp" href="#parse_leap_seconds_dat">parse-leap-seconds-dat<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>seconds<span class="dash">-</span>dat: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>() </span>}

<span class="decl-val" id="jd_epoch_shift"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#jd_epoch_shift">jd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>     <span class="kw">=</span> <span class="number">2400000.5</span><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan_1">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a></span>
<span class="decl-val" id="mjd_epoch_shift"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#mjd_epoch_shift">mjd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>    <span class="kw">=</span> <span class="number">4453401600</span><span class="kw op">.</span><a class="pp" href="std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a></span> <span class="comment">// 2000-01-01 TAI - 1858-11-17 TAI modified julian date epoch
</span>

<span class="comment">// Parse the standard UTC leap second adjustment file.\
// See &lt;http://maia.usno.navy.mil/ser7/tai-utc.dat&gt;
</span><span class="decl-fun" id="parse_leap_seconds_dat"><span class="kw">fun</span> <a class="pp" href="std_time_utc.html#parse_leap_seconds_dat">parse-leap-seconds-dat<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>seconds<span class="dash">-</span>dat: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp op">?</span><span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#leap_seconds_dat">leap-seconds-dat<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>seconds<span class="dash">-</span>dat: <span class="tp">string</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#find_all">find-all<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>find<span class="dash">-</span>all: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">regex</span> <span class="tp kw op">:</span> <span class="tp">regex</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">matched</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#rxtaiadjust">rxtaiadjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>rxtaiadjust: <span class="tp">regex</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a>) {
    <span class="kw">val</span> <a class="pp">mjd<span class="pc">mjd: <span class="tp">ddouble</span></span></a>    <span class="kw">=</span> <a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#groups">groups<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>groups: <span class="tp sp">(</span><span class="tp tpp">matched</span> <span class="tp kw op">:</span> <span class="tp">matched</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">groups</span></span></a><a class="pp" href="std_text_regex-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>[]: <span class="tp sp">(</span><span class="tp tpp">groups</span> <span class="tp kw op">:</span> <span class="tp">groups</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="number">1</span>]<span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#parse_ddouble">parse-ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>parse<span class="dash">-</span>ddouble: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="#jd_epoch_shift">jd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>) <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#jd_epoch_shift">jd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a> 
    <span class="kw">val</span> <a class="pp">ofs<span class="pc">ofs: <span class="tp">ddouble</span></span></a>    <span class="kw">=</span> <a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#groups">groups<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>groups: <span class="tp sp">(</span><span class="tp tpp">matched</span> <span class="tp kw op">:</span> <span class="tp">matched</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">groups</span></span></a><a class="pp" href="std_text_regex-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>[]: <span class="tp sp">(</span><span class="tp tpp">groups</span> <span class="tp kw op">:</span> <span class="tp">groups</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="number">2</span>]<span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#parse_ddouble">parse-ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>parse<span class="dash">-</span>ddouble: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a>)
    <span class="kw">val</span> <a class="pp">dmjd<span class="pc">dmjd: <span class="tp">ddouble</span></span></a>   <span class="kw">=</span> <a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#groups">groups<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>groups: <span class="tp sp">(</span><span class="tp tpp">matched</span> <span class="tp kw op">:</span> <span class="tp">matched</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">groups</span></span></a><a class="pp" href="std_text_regex-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>[]: <span class="tp sp">(</span><span class="tp tpp">groups</span> <span class="tp kw op">:</span> <span class="tp">groups</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="number">3</span>]<span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#parse_ddouble">parse-ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>parse<span class="dash">-</span>ddouble: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a>)
    <span class="kw">val</span> <a class="pp">delta<span class="pc">delta: <span class="tp">ddouble</span></span></a>  <span class="kw">=</span> <a class="pp">cap<span class="pc">cap: <span class="tp">matched</span></span></a><span class="kw op">.</span><a class="pp" href="std_text_regex-source.html#groups">groups<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>groups: <span class="tp sp">(</span><span class="tp tpp">matched</span> <span class="tp kw op">:</span> <span class="tp">matched</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">groups</span></span></a><a class="pp" href="std_text_regex-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>[]: <span class="tp sp">(</span><span class="tp tpp">groups</span> <span class="tp kw op">:</span> <span class="tp">groups</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="number">4</span>]<span class="kw op">.</span><a class="pp" href="std_num_ddouble-source.html#parse_ddouble">parse-ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>parse<span class="dash">-</span>ddouble: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a>)
    <span class="kw">val</span> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">mjd<span class="pc">mjd: <span class="tp">ddouble</span></span></a><a class="pp" href="std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#mjd_epoch_shift">mjd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>)  <span class="comment">//instant(1858,11,17 + mjd.int)
</span>    <span class="kw">val</span> <a class="pp">dstart<span class="pc">dstart: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap<span class="dash">-</span>adjust</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">dmjd<span class="pc">dmjd: <span class="tp">ddouble</span></span></a><a class="pp" href="std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="#secs_per_day">secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a> <a class="pp" href="std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#mjd_epoch_shift">mjd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>) <span class="comment">//instant(1858,11,17 + dmjd.int)
</span>    <span class="comment">// trace("pre72 start=" + start.show + ", ofs: " + ofs.show + ", delta: " + delta.show )
</span>    <a class="pp" href="#con_space_Leap_adjust"><span class="co">Leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">delta<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">delta</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>( <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>, <a class="pp">ofs<span class="pc">ofs: <span class="tp">ddouble</span></span></a>, <a class="pp">dstart<span class="pc">dstart: <span class="tp">timestamp</span></span></a>, <a class="pp">delta<span class="pc">delta: <span class="tp">ddouble</span></span></a> )
  })<span class="kw op">.</span><a class="pp" href="std_core-source.html#reverse">reverse<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
</span>}
<span class="decl-val" id="rxtaiadjust"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#rxtaiadjust">rxtaiadjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>rxtaiadjust: <span class="tp">regex</span></span></a> <span class="kw">=</span> <a class="pp" href="std_text_regex-source.html#regex">regex<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>regex<span class="fslash last">/</span></span>regex: <span class="tp sp">(</span><span class="tp tpp">regex</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ignorecase</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">multiline</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">regex</span></span></a>(<span class="st">"^ &#42;\\d[^=]&#42;=JD (\\d+\\.\\d+) &#42;TAI-UTC= &#42;(-?\\d+\\.\\d+)[^\\d]+(\\d+\\.\\d&#42;)[^\\d]+(\\d+\\.\\d+) &#42;S &#42;$"</span>, multiLine<span class="kw">=</span><a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a></span>)

<span class="comment">// TAI leap second adjustments for dates before 1972-01-01Z are linear interpolations.
// TAI started in 1958-01-01Z. The initial official UTC time step in 1961-01-01Z was 1.422818s and before that there 
// were small steps of 20ms. See Explanatory Supplement to the Astronomical Almanac, 1992 edition, pages 86--87.
// In 1958, the supplement remarks that WWC operated at an offset of &#95;about&#95; -100e-10, we 
// change it to -85e-10 to end up with TAI-UTC == 0 at 1958-01-01. 
// (without a rate change it is a negative -0.0272380s). 
// Note the JD dates are at 0.29167 as the time steps were usually at 19:00h instead of midnight.
</span><span class="decl-val" id="leap_seconds_dat"><span class="kw">val</span> <a class="pp" href="std_time_utc.html#leap_seconds_dat">leap-seconds-dat<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>seconds<span class="dash">-</span>dat: <span class="tp">string</span></span></a> <span class="kw">=</span> <span class="st">"\n  # from: Explanatory Supplement to the Astronomical Almanac, 1992 edition, pages 86--87.\n  1958 JAN  1 =JD 2436204.5     TAI-UTC= 0.0  S + (MJD - 36204.) X 0.00073458 S\n  1958 JAN 15 =JD 2436219.29167 TAI-UTC= 0.02 S + (MJD - 36204.) X 0.00073458 S\n  1958 FEB  5 =JD 2436240.29167 TAI-UTC= 0.04 S + (MJD - 36204.) X 0.00073458 S\n  1958 FEB 19 =JD 2436254.29167 TAI-UTC= 0.06 S + (MJD - 36204.) X 0.00073458 S\n  1958 APR  9 =JD 2436303.29167 TAI-UTC= 0.08 S + (MJD - 36204.) X 0.00073458 S\n  1958 JUN 11 =JD 2436366.29167 TAI-UTC= 0.10 S + (MJD - 36204.) X 0.00073458 S\n  1958 JUL  2 =JD 2436387.29167 TAI-UTC= 0.12 S + (MJD - 36204.) X 0.00073458 S\n  1958 JUL 16 =JD 2436401.29167 TAI-UTC= 0.14 S + (MJD - 36204.) X 0.00073458 S\n  1958 OCT 22 =JD 2436499.29167 TAI-UTC= 0.16 S + (MJD - 36204.) X 0.00073458 S\n  1958 NOV 26 =JD 2436534.29167 TAI-UTC= 0.18 S + (MJD - 36204.) X 0.00073458 S\n  1958 DEC 24 =JD 2436562.29167 TAI-UTC= 0.20 S + (MJD - 36204.) X 0.00073458 S\n  \n  1959 JAN  1 =JD 2436569.5     TAI-UTC= 0.4681220 S + (MJD - 36569.) X 0.000864 S\n  1959 JAN 28 =JD 2436597.29167 TAI-UTC= 0.4881220 S + (MJD - 36569.) X 0.000864 S\n  1959 FEB 25 =JD 2436625.29167 TAI-UTC= 0.5081220 S + (MJD - 36569.) X 0.000864 S\n  1959 APR  5 =JD 2436664.29167 TAI-UTC= 0.5281220 S + (MJD - 36569.) X 0.000864 S\n  1959 AUG 26 =JD 2436807.29167 TAI-UTC= 0.5481220 S + (MJD - 36569.) X 0.000864 S\n  1959 SEP 30 =JD 2436842.29167 TAI-UTC= 0.5681220 S + (MJD - 36569.) X 0.000864 S\n  1959 NOV  4 =JD 2436877.29167 TAI-UTC= 0.5881220 S + (MJD - 36569.) X 0.000864 S\n  1959 NOV 18 =JD 2436891.29167 TAI-UTC= 0.6081220 S + (MJD - 36569.) X 0.000864 S\n  1959 DEC 16 =JD 2436919.29167 TAI-UTC= 0.6281220 S + (MJD - 36569.) X 0.000864 S\n  1960 JAN  1 =JD 2436934.5     TAI-UTC= 0.9434820 S + (MJD - 36934.) X 0.001296 S\n\n  # from: http://maia.usno.navy.mil/ser7/tai-utc.dat\n  1961 JAN  1 =JD 2437300.5  TAI-UTC=   1.4228180 S + (MJD - 37300.) X 0.001296 S\n  1961 AUG  1 =JD 2437512.5  TAI-UTC=   1.3728180 S + (MJD - 37300.) X 0.001296 S\n  1962 JAN  1 =JD 2437665.5  TAI-UTC=   1.8458580 S + (MJD - 37665.) X 0.0011232S\n  1963 NOV  1 =JD 2438334.5  TAI-UTC=   1.9458580 S + (MJD - 37665.) X 0.0011232S\n  1964 JAN  1 =JD 2438395.5  TAI-UTC=   3.2401300 S + (MJD - 38761.) X 0.001296 S\n  1964 APR  1 =JD 2438486.5  TAI-UTC=   3.3401300 S + (MJD - 38761.) X 0.001296 S\n  1964 SEP  1 =JD 2438639.5  TAI-UTC=   3.4401300 S + (MJD - 38761.) X 0.001296 S\n  1965 JAN  1 =JD 2438761.5  TAI-UTC=   3.5401300 S + (MJD - 38761.) X 0.001296 S\n  1965 MAR  1 =JD 2438820.5  TAI-UTC=   3.6401300 S + (MJD - 38761.) X 0.001296 S\n  1965 JUL  1 =JD 2438942.5  TAI-UTC=   3.7401300 S + (MJD - 38761.) X 0.001296 S\n  1965 SEP  1 =JD 2439004.5  TAI-UTC=   3.8401300 S + (MJD - 38761.) X 0.001296 S\n  1966 JAN  1 =JD 2439126.5  TAI-UTC=   4.3131700 S + (MJD - 39126.) X 0.002592 S\n  1968 FEB  1 =JD 2439887.5  TAI-UTC=   4.2131700 S + (MJD - 39126.) X 0.002592 S"</span></span>

</pre>

</div></body>
</html>
