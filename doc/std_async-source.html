<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>async.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;---------------------------------------------------------------------------
  Copyright 2012-2016 Microsoft Corporation.
 
  This is free software; you can redistribute it and/or modify it under the
  terms of the Apache License, Version 2.0. A copy of the License can be
  found in the file "license.txt" at the root of this distribution.
---------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; Asynchronous primitives

This module is based closely on [@Leijen:async].


## References {-}

~ Bibliography { caption:"0" }
~~ BibItem { #Leijen:async; bibitem-label:"[1]"; searchterm:"Leijen+Daan+Structured+Asynchrony+with+Algebraic+Effects" }
Daan Leijen.
&#95;Structured Asynchrony with Algebraic Effects&#95;.
Microsoft Research technical report MSR-TR-2017-21, May 2017.
[pdf](https://www.microsoft.com/en-us/research/wp-content/uploads/2017/05/asynceffects-msr-tr-2017-21.pdf)
~~
~
\/
&#42;/</span>
<span class="kw">module</span> async

<span class="kw">import</span> dict
<span class="kw">import</span> array
<span class="kw">import</span> int32
<span class="kw">import</span> duration

<span class="comment">// A type alias for asynchronous operations that can raise exceptions non-deterministically.
// This is common for almost all &#96;:async&#96; operations since &#96;cancelable&#96; and &#96;timeout&#96; can
// cancel operations non-deterministically which raises the &#96;Cancel&#96; exception and cancels
// outstanding asynchronous requests. 
</span><span class="decl-alias" id="type_space_asyncx"><span class="kw">public</span> <span class="tp kw">alias</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <span class="tp kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a></span><span class="tp sp">&gt;</span>


<span class="decl-type" id="type_space_promise"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Promise"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>(
  <span class="decl-fun" id="state"><a class="pp">state<span class="pc">state: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="number">36</span>) <span class="kw op">-></span> io ()<span class="op">&gt;</span>,<span class="number">36</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_ref"><span class="tp">ref</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="tp">H</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_global"><span class="tp">global</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>global: <span class="tp">H</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span>
</span></span>)

<span class="comment">// ----------------------------------------------------------------------------
// Promises
// ----------------------------------------------------------------------------
</span>
<span class="decl-fun" id="promise"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#promise">promise<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp" href="#async_io">async-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>{ <a class="pp" href="#con_space_Promise"><span class="co">Promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Promise: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">state</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>))) }
</span>}

<span class="decl-fun" id="await"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;782</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">&#95;782</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;782</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
  <a class="pp" href="#await1">await1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">rcount</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
    <span class="kw">match</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">&#95;782</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">&#95;782</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>))
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;782</span></span></a>)    <span class="kw op">-></span> <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tv">&#95;782</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;782</span></span></a>)
    }
  }
</span>}

<span class="decl-fun" id="resolve"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#resolve">resolve<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>resolve: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;7808</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;7808</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;7808</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">&#95;7808</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;7808</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
  <a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;7930</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;7822</span></span></a>) {
    <span class="kw">match</span>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;7808</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">&#95;7808</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;7808</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
        <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;7808</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp tv">&#95;7808</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;7808</span></span></a>)
        <a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;7808</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#foreach">foreach<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>foreach: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>(<a class="pp">cbx<span class="pc">cbx: <span class="tp sp">(</span><span class="tp tv">&#95;7808</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
          <a class="pp">cbx<span class="pc">cbx: <span class="tp sp">(</span><span class="tp tv">&#95;7808</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;7808</span></span></a>) <span class="comment">// set-immediate1( cbx, value )
</span>        }
        <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;7930</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;7822</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>))
      }
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;7930</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;7822</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#exception">exception<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception</span></span></a>(<span class="st">"promise was already resolved."</span>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Error"><span class="co">Error</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Error: <span class="tp">exception<span class="dash">-</span>info</span></span></a>)))
    }
  }
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Asynchronous timeout and waiting
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Wait (asynchronously) for &#96;secs&#96; seconds as a &#96;:double&#96;. 
// Use &#96;yield()&#96; to yield to other asynchronous operations.
</span><span class="decl-fun" id="wait"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#wait">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#wait_1">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#duration_2">duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>)
</span>}

<span class="comment">// Wait (asynchronously) for optional &#96;secs&#96; seconds &#96;:duration&#96; (&#96;= 0s&#96;). 
// Use &#96;yield()&#96; to yield generally to other asynchronous operations.
// If the wait time is longer than 200ms the wait can be canceled.
</span><span class="decl-fun" id="wait_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#wait_1">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp op">?</span><span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_optional"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">secs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">200</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#milli_seconds_1">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp" href="#cancelable_wait">cancelable-wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable<span class="dash">-</span>wait: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a>) 
  <span class="kw">elif</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">secs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
  <span class="kw">else</span> <a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a>)
</span>}


<span class="comment">// Wait for &#96;secs&#96; seconds duration and allow cancelation.
</span><span class="decl-fun" id="cancelable_wait"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancelable_wait">cancelable-wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable<span class="dash">-</span>wait: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">secs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="kw">else</span> {
    <span class="kw">var</span> <a class="pp">vtid<span class="pc">vtid: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5612</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> 
    <span class="kw">match</span>(<a class="pp" href="#fork_after">fork-after<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>fork<span class="dash">-</span>after: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a>)) {
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> {
        <span class="kw">match</span>(<a class="pp">vtid<span class="pc">vtid: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5612</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
          <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>   <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
          <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>) <span class="kw op">-></span> <a class="pp" href="#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">tid</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>)
        }
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#throw">throw<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>throw: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
      }
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">mbtid<span class="pc">mbtid: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
        <a class="pp">vtid<span class="pc">vtid: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5612</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">mbtid<span class="pc">mbtid: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span></span></a>
        <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">mbtid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#just_ques_">just?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>just?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">maybe</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp" href="#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>() <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>          
      }
    }
  }
</span>}


<span class="decl-fun" id="xtimeout"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#xtimeout">xtimeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>xtimeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>, <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8444</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8348</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#catch">catch<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>catch: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">hndl</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a> {
    <span class="kw">val</span> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;8348</span></span></a> <span class="kw">=</span> <a class="pp" href="#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
      <span class="kw">match</span>(<a class="pp" href="#fork_after">fork-after<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>fork<span class="dash">-</span>after: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>) {
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> {
          <a class="pp" href="#cancel_1">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
          <a class="pp" href="#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>()
        }
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>) <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#finally">finally<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>finally: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">hndl</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8444</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8348</span></span></a>) { <a class="pp" href="#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">tid</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>) } <span class="comment">// ouch: clear-timeout prevents resuming twice
</span>      }
    }
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;8348</span></span></a>)
  }
  <span class="kw">fun</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) {
    <span class="kw">match</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#info">info<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>info: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>) {
      <a class="pp" href="#con_space_Cancel"><span class="co">Cancel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Cancel: <span class="tp">exception<span class="dash">-</span>info</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
      &#95;      <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#throw">throw<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>throw: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
    }
  }
</span>}

<span class="decl-fun" id="fork_after"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#fork_after">fork-after<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>fork<span class="dash">-</span>after: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> {
  <a class="pp" href="#awaitx1">awaitx1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">rcount</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
    <span class="kw">val</span> <a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a> <span class="kw">=</span> <a class="pp" href="#set_timeout1">set-timeout1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">,</span> <span class="tp tpp">arg</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>, <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_int32-source.html#max">max<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>max: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>(<span class="number">0</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_int32-source.html#int32">int32<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>,<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#milli_seconds">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_int32-source.html#int32">int32<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>), <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> )
    <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>))
  }, <span class="number">2</span> )
</span>} 

<span class="comment">// Execute &#96;action&#96; but if it is not finished within &#96;secs&#96; seconds duration
// &#96;cancel&#96; it.
</span><span class="decl-fun" id="timeout"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#timeout">timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>, <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;8314</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8331</span></span></a> )  {
  <a class="pp" href="#firstof">firstof<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>firstof: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">a</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">b</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> 
    { <a class="pp" href="#wait_1">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a>); <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> }
    { <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;8314</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8331</span></span></a>()) }
</span>}

<span class="comment">// Execute &#96;a&#96; and &#96;b&#96; interleaved. As soon as one of them finishes,
// &#96;cancel&#96; the other one and return the result of the first.
</span><span class="decl-fun" id="firstof"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#firstof">firstof<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>firstof: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">a</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">b</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">a<span class="pc">a: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;6141</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6135</span></span></a>, <a class="pp">b<span class="pc">b: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;6141</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6135</span></span></a> ) {
  <a class="pp" href="#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
    <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ra<span class="pc">ra: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6135</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">rb<span class="pc">rb: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6135</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="#interleavedx">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">a</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">b</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a> { <span class="kw">val</span> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;6135</span></span></a> <span class="kw">=</span> <a class="pp">a<span class="pc">a: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;6141</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6135</span></span></a>(); <a class="pp" href="#cancel_1">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(); <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;6135</span></span></a> }
                               { <span class="kw">val</span> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;6135</span></span></a> <span class="kw">=</span> <a class="pp">b<span class="pc">b: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;6141</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6135</span></span></a>(); <a class="pp" href="#cancel_1">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(); <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;6135</span></span></a> }
    <span class="kw">match</span>(<a class="pp">ra<span class="pc">ra: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6135</span><span class="tp sp">&gt;</span></span></a>) {
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="op">|</span> <a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#info">info<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>info: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a><span class="kw op">.</span><a class="pp" href="#cancel_ques_">cancel?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel?: <span class="tp sp">(</span><span class="tp tpp">exception<span class="dash">-</span>info</span> <span class="tp kw op">:</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="kw op">-></span> <a class="pp">rb<span class="pc">rb: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6135</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a> 
      &#95; <span class="kw op">-></span> <a class="pp">ra<span class="pc">ra: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6135</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
    }
  }                              
</span>} 


<span class="comment">// ----------------------------------------------------------------------------
// Yield
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Wait for optional &#96;secs&#96; duration (=&#96;0&#96;). Use &#96;yield()&#96; to generally yield
// to other asynchronous operations. Note that &#96;yield&#96; is not cancelable,
// use &#96;wait&#96; instead if waiting for more than short durations.
</span><span class="decl-fun" id="yield"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp op">?</span><span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_optional"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#await0">await0<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await0: <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>){ 
    <a class="pp" href="#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>, <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_int32-source.html#max">max<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>max: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_int32-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>zero: <span class="tp">int32</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a>,<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#milli_seconds">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_int32-source.html#int32">int32<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>) )
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
  }
</span>}

<span class="comment">// abstract wid for timeout handlers
</span><span class="decl-type" id="type_space_timeout_id"><span class="tp kw">type</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a></span>

<span class="decl-fun" id="set_timeout1"><span class="kw">extern</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#set_timeout1">set-timeout1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">,</span> <span class="tp tpp">arg</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tv">&#95;550</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">ms<span class="pc">ms: <span class="tp">int32</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a>, <a class="pp">arg<span class="pc">arg: <span class="tp tv">&#95;550</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a> {
  js <span class="st">"setTimeout"</span>
</span>}

<span class="decl-fun" id="set_timeout"><span class="kw">extern</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">ms<span class="pc">ms: <span class="tp">int32</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a> {
  js <span class="st">"setTimeout"</span>
</span>}

<span class="decl-fun" id="clear_timeout"><span class="kw">extern</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">tid</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  js <span class="st">"clearTimeout"</span>
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// Asynchronous cancelation 
// ----------------------------------------------------------------------------
</span>


<span class="comment">// ----------------------------------------------------------------------------
// Synchronous blocks (uninterleaved sequences of async operations)
// ----------------------------------------------------------------------------
</span>

<span class="comment">// ----------------------------------------------------------------------------
// Asynchronous operations are supported through the &#96;:async&#96; effect.
// The basic effect is in core since it usually requires some support from the host system.
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Interleave a list of actions.
</span><span class="decl-fun" id="interleaved"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#interleaved">interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;6346</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6345</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp" href="#interleaved_1">interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;6346</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6345</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#vector_3">vector<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector<span class="postfix">.3</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#list_5">list<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
</span>}

<span class="decl-fun" id="interleaved_1"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#interleaved_1">interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;7127</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6725</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_vector"><span class="tp">vector</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_vector"><span class="tp">vector</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp" href="#async_handle_interleaved">async-handle-interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>handle<span class="dash">-</span>interleaved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
    <span class="kw">val</span> <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">xs<span class="pc">xs: <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;7127</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6725</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#length_2">length<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>length<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
    <span class="comment">//if (n==0) return vector()
</span>    <span class="kw">val</span> <a class="pp">res<span class="pc">res: <span class="tp">array</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6795</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6725</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>    <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_data_array-source.html#array">array<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>array<span class="fslash last">/</span></span>array: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">array</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#exception">exception<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception</span></span></a>(<span class="st">"Interleaved operation was not completed"</span>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Internal"><span class="co">Internal</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Internal: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>(<span class="st">"std/async/interleaved"</span>))))
    <span class="kw">var</span> <a class="pp">count<span class="pc">count: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6795</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>;
    <span class="kw">val</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#primforkn">primforkn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>primforkn: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">int</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>)
    <a class="pp">res<span class="pc">res: <span class="tp">array</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6795</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6725</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_data_array-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>array<span class="fslash last">/</span></span>[]<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">a</span> <span class="tp kw op">:</span> <span class="tp">array</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>] <span class="kw op">:=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#try">try<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#inject_st_1">inject-st<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>inject<span class="dash">-</span>st<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">st</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(<a class="pp">xs<span class="pc">xs: <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;7127</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6725</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>[]: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>]) )
    <a class="pp">count<span class="pc">count: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6795</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">count<span class="pc">count: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6795</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>
    <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">count</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_gt__1">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">0</span>) { <a class="pp" href="#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>() <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">}</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
    <a class="pp">res<span class="pc">res: <span class="tp">array</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6795</span><span class="tp sp">,</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;6725</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_data_array-source.html#vector">vector<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>array<span class="fslash last">/</span></span>vector: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">self</span> <span class="tp kw op">:</span> <span class="tp">array</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#map_7">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.7</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>)
  }
</span>}

<span class="comment">// Interleave two asynchronous actions.
</span><span class="decl-fun" id="interleaved_2"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#interleaved_2">interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">a</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">b</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>( <a class="pp">a<span class="pc">a: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;7668</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;7666</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">b<span class="pc">b: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;7668</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;7667</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ra<span class="pc">ra: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;7666</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">rb<span class="pc">rb: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;7667</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="#interleavedx">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">a</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">b</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>(<a class="pp">a<span class="pc">a: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;7668</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;7666</span></span></a>,<a class="pp">b<span class="pc">b: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;7668</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;7667</span></span></a>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ra<span class="pc">ra: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;7666</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>,<a class="pp">rb<span class="pc">rb: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;7667</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
</span>}

<span class="comment">// Interleave two asynchronous actions and return either their result or their exceptional value.
</span><span class="decl-fun" id="interleavedx"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#interleavedx">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">a</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">b</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">a<span class="pc">a: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6106</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;5884</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">b<span class="pc">b: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6106</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;5885</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <a class="pp" href="#async_handle_interleaved">async-handle-interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>handle<span class="dash">-</span>interleaved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
    <span class="kw">var</span> <a class="pp">ares<span class="pc">ares: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5892</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    <span class="kw">var</span> <a class="pp">bres<span class="pc">bres: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5892</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    <span class="kw">val</span> <a class="pp">forked<span class="pc">forked: <span class="tp">bool</span></span></a> <span class="kw">=</span> <a class="pp" href="#primfork">primfork<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>primfork: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a>()
    <span class="kw">if</span> (<a class="pp">forked<span class="pc">forked: <span class="tp">bool</span></span></a>) <span class="kw">then</span> {
      <span class="kw">val</span> <a class="pp">br<span class="pc">br: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#try">try<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="#injectst">injectst<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>injectst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">st</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(<a class="pp">b<span class="pc">b: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6106</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;5885</span></span></a>) )
      <span class="kw">match</span>(<a class="pp">ares<span class="pc">ares: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5892</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>  <span class="kw op">-></span> { <a class="pp">bres<span class="pc">bres: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5892</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">br<span class="pc">br: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span></span></a>); <a class="pp" href="#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>() }
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">ar<span class="pc">ar: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ar<span class="pc">ar: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">br<span class="pc">br: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
      }
    }
    <span class="kw">else</span> {
      <span class="kw">val</span> <a class="pp">ar<span class="pc">ar: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#try">try<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="#injectst">injectst<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>injectst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">st</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(<a class="pp">a<span class="pc">a: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6106</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;5884</span></span></a>) )
      <span class="kw">match</span>(<a class="pp">bres<span class="pc">bres: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5892</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>  <span class="kw op">-></span> { <a class="pp">ares<span class="pc">ares: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5892</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">ar<span class="pc">ar: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span></span></a>); <a class="pp" href="#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>() }
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">br<span class="pc">br: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ar<span class="pc">ar: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5884</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">br<span class="pc">br: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;5885</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
      }
    }
  }
</span>}

<span class="decl-external" id="injectst"><span class="kw">extern</span> inline <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#injectst">injectst<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>injectst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">st</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(action <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_total"><span class="tp"><span class="effect">total</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="tp">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> {
  js inline <span class="st">"(#1)"</span>
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Forking
// ----------------------------------------------------------------------------
</span>
<span class="decl-fun" id="fork"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#fork">fork<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>fork: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;6213</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6223</span></span></a> )  {  
  <span class="kw">val</span> <a class="pp">forked<span class="pc">forked: <span class="tp">bool</span></span></a> <span class="kw">=</span> <a class="pp" href="#primfork">primfork<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>primfork: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a>()
  <span class="kw">if</span> (<a class="pp">forked<span class="pc">forked: <span class="tp">bool</span></span></a>) <span class="kw">then</span> {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#catch">catch<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>catch: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">hndl</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a> {
      <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;6213</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6223</span></span></a>()
      <a class="pp" href="#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>()
    }
    <span class="kw">fun</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) { 
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#trace">trace<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trace: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"unhandled fork exception: "</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#show">show<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>show: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>)
      <a class="pp" href="#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>() 
    }
  }
  <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
</span>}

<span class="decl-fun" id="primfork"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#primfork">primfork<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>primfork: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a>( ) {
  <span class="kw">val</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#primforkn">primforkn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>primforkn: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)
  (<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">0</span>)
</span>} 

<span class="decl-fun" id="primforkn"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#primforkn">primforkn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>primforkn: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">int</span></span></a>( <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">n</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">1</span>) <span class="kw">then</span> <span class="number">0</span> <span class="kw">else</span> {
    <a class="pp" href="#await1">await1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">rcount</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#for">for<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>for: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="number">1</span>, <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>) <span class="kw">fun</span>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>) {
        <a class="pp" href="#set_immediate1">set-immediate1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>immediate1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">arg</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>, <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> )
      }
      <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="number">0</span>)
    }, <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>)
  }
</span>}

<span class="decl-fun" id="set_immediate"><span class="kw">extern</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#set_immediate">set-immediate<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>immediate: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">&#95;617</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  js inline <span class="st">"(typeof setImmediate !== 'undefined' ? setImmediate(#1) : setTimeout(#1,0))"</span>
</span>}

<span class="decl-fun" id="set_immediate1"><span class="kw">extern</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#set_immediate1">set-immediate1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>immediate1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">arg</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp tv">&#95;573</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">&#95;574</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">arg<span class="pc">arg: <span class="tp tv">&#95;573</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  js inline <span class="st">"(typeof setImmediate !== 'undefined' ? setImmediate(#1,#2) : setTimeout(#1,0,#2))"</span>
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// awaitx wrappers
// ----------------------------------------------------------------------------
</span>
<span class="decl-fun" id="await_exn0"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_exn0">await-exn0<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>exn0: <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
    <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>) { <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#unnull">unnull<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unnull: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">nexn</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)) }) 
  } )
</span>}

<span class="decl-fun" id="await_exn1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_exn1">await-exn1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>exn1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">&#95;4388</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4388</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
    <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">&#95;4388</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4388</span></span></a>) { <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4388</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#unnull">unnull<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unnull: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">nexn</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4388</span></span></a>)) })
  } )
</span>}

<span class="decl-fun" id="unnull"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#unnull">unnull<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unnull: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">nexn</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;473</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">match</span>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#maybe">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;473</span></span></a>)
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
  }
</span>}

<span class="decl-fun" id="await0"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await0">await0<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await0: <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4473</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>() { <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4473</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)) } ) } )
</span>}

<span class="decl-fun" id="await1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await1">await1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">rcount</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;1551</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">rcount<span class="pc">rcount: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1</span> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="#awaitx">awaitx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">resume<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1551</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;1551</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;1551</span></span></a>) { <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1551</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;1551</span></span></a>)) } ) }, <a class="pp">rcount<span class="pc">rcount: <span class="tp">int</span></span></a> )<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
</span>}

<span class="decl-fun" id="await_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;881</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="#awaitx">awaitx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">resume<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;881</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>, <span class="number">1</span> )<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
</span>}

<span class="decl-fun" id="awaitx0"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#awaitx0">awaitx0<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx0: <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">rcount</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">rcount<span class="pc">rcount: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1</span> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">val</span> <a class="pp">res<span class="pc">res: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="#awaitx">awaitx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">resume<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>){ <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(){ <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)) } ) }, <a class="pp">rcount<span class="pc">rcount: <span class="tp">int</span></span></a> ) 
  <span class="kw">match</span>(<a class="pp">res<span class="pc">res: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
  }
</span>}

<span class="decl-fun" id="awaitx1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#awaitx1">awaitx1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">rcount</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;4562</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">rcount<span class="pc">rcount: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1</span> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp" href="#awaitx">awaitx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">resume<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4562</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>){ <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;4562</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4562</span></span></a>){ <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4562</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4562</span></span></a>)) } ) }, <a class="pp">rcount<span class="pc">rcount: <span class="tp">int</span></span></a> )
</span>}

<span class="decl-fun" id="awaitx"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#awaitx">awaitx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>awaitx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">resume<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1010</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span>, <a class="pp">resume-count<span class="pc">resume<span class="dash">-</span>count: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">var</span> <a class="pp">count<span class="pc">count: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp">resume-count<span class="pc">resume<span class="dash">-</span>count: <span class="tp">int</span></span></a>
  <a class="pp" href="#await_done">await-done<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>done: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1010</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
    <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1010</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1010</span><span class="tp sp">&gt;</span></span></a>) {
      <a class="pp">count<span class="pc">count: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">count<span class="pc">count: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>
      <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1010</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;1010</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">count<span class="pc">count: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">0</span>)
    })
  })<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// Callback widentifiers
// ----------------------------------------------------------------------------
</span>
  
<span class="decl-type" id="type_space_wid"><span class="kw">private</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Wid"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a>( <span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> </span></span>)

<span class="decl-val" id="wid_exit"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#wid_exit">wid-exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid<span class="dash">-</span>exit: <span class="tp">wid</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Wid"><span class="co">Wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Wid: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">wid</span></span></a>(<span class="number">-1</span></span>)

<span class="decl-fun" id="_eq__eq_"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#_eq__eq_">(==)<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">wid1<span class="pc">wid1: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a>, <a class="pp">wid2<span class="pc">wid2: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <span class="kw">match</span>(<a class="pp">wid1<span class="pc">wid1: <span class="tp">wid</span></span></a>) {
    <a class="pp" href="#con_space_Wid"><span class="co">Wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Wid: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">wid</span></span></a>(<a class="pp">i1<span class="pc">i1: <span class="tp">int</span></span></a>) <span class="kw op">-></span> <span class="kw">match</span>(<a class="pp">wid2<span class="pc">wid2: <span class="tp">wid</span></span></a>) {
      <a class="pp" href="#con_space_Wid"><span class="co">Wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Wid: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">wid</span></span></a>(<a class="pp">i2<span class="pc">i2: <span class="tp">int</span></span></a>) <span class="kw op">-></span> <a class="pp">i1<span class="pc">i1: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp">i2<span class="pc">i2: <span class="tp">int</span></span></a>
    }
  }
</span>}

<span class="decl-fun" id="_excl__eq_"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#_excl__eq_">(!=)<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(!=): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">wid1<span class="pc">wid1: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a>, <a class="pp">wid2<span class="pc">wid2: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">wid1<span class="pc">wid1: <span class="tp">wid</span></span></a> <a class="pp" href="#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">wid2<span class="pc">wid2: <span class="tp">wid</span></span></a>)
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// Async effect
// ----------------------------------------------------------------------------
</span>
<span class="decl-alias" id="type_space_await_result"><span class="tp kw">alias</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#type_space_await_result"><span class="tp">await-result</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>result: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a></span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a>

<span class="comment">// Asynchronous operations have the &#96;:async&#96; effect.
</span><span class="decl-type" id="type_space_async"><a class="pp"><span class="kw">abstract</span><span class="pc">: <span class="tp kw op">.</span><span class="tp">ops<span class="dash">-</span>async</span><span class="tp sp">&lt;</span><span class="number">40</span><span class="op">&gt;</span></span></a> <span class="tp kw">effect</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a></span> {
  <span class="kw">fun</span> <span class="decl-fun" id="await_id"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_id">await-id<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">wid</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a></span>  
  <span class="kw">fun</span> <span class="decl-fun" id="await_2"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_2">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">setup<span class="pc">: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="number">20</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()) <span class="kw op">-></span> io ()</span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <a class="pp" href="#type_space_await_result"><span class="tp">await-result</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>result: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">wid<span class="pc">: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_await_result"><span class="tp">await-result</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>result: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a></span><span class="tp sp">&gt;</span>
  <span class="kw">fun</span> <span class="decl-fun" id="cancel"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">awaits</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">awaits<span class="pc">: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
}

<span class="decl-fun" id="await_done"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_done">await-done<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>done: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> <span class="kw">=</span> <a class="pp" href="#await_id">await-id<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">wid</span></span></a>()
  <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a>,&#95;<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="#await_2">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>){
                      <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a>){ <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#left_ques_">left?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>left?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">either</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>, <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a>) })
                    }, <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;925</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
</span>}

<span class="comment">// The &#96;cancel&#96; operations cancels any outstanding asynchronous operation under the innermost
// &#96;cancelable&#96; handler by returning the &#96;Cancel&#96; exception. The &#96;cancel&#96; operation itself returns normally
// without raising a &#96;Cancel&#96; exception.
</span><span class="decl-fun" id="cancel_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancel_1">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>{
  <a class="pp" href="#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">awaits</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
</span>}

<span class="comment">// Exits the current asynchronous strand of execution without raising an exception.
</span><span class="decl-fun" id="exit"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#exit">exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="#await_2">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5288</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">{</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">}</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>, <a class="pp" href="#wid_exit">wid-exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid<span class="dash">-</span>exit: <span class="tp">wid</span></span></a> )<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#fst_1">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
  <span class="comment">//error("exit should never resume") 
</span>  <span class="comment">//()
</span></span>}

<span class="decl-fun" id="async_io"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#async_io">async-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">&#95;4204</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4204</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="#await_done">await-done<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>done: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4204</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4204</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#try">try<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">&#95;4204</span></span></a>), <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> ) } )
  <a class="pp">r<span class="pc">r: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">&#95;4204</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Async handlers: cancelable
// ----------------------------------------------------------------------------
</span>
<span class="comment">// The &#96;Cancel&#96; exception.
</span><span class="decl-type" id="type_space_exception_info"><span class="kw">public</span> <span class="tp kw">type</span> <span class="tp">extend</span> <span class="tp">exception<span class="dash">-</span>info</span> {
  <span class="comment">// The &#96;Cancel&#96; exception is thrown when an asynchronous operation is canceled.
</span>  <span class="decl-con" id="con_space_Cancel"><span class="kw">con</span> <span class="decl-fun" id="cancel_ques_"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#con_space_Cancel"><span class="co">Cancel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Cancel: <span class="tp">exception<span class="dash">-</span>info</span></span></a></span></span>
</span>}

<span class="decl-fun" id="on_cancel"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#on_cancel">on-cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>on<span class="dash">-</span>cancel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">oncancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">oncancel<span class="pc">oncancel: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;592</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;592</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;591</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#on_exn">on-exn<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>on<span class="dash">-</span>exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">hndler</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<span class="kw">fun</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) {
    <span class="kw">match</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#info">info<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>info: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>) {
      <a class="pp" href="#con_space_Cancel"><span class="co">Cancel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Cancel: <span class="tp">exception<span class="dash">-</span>info</span></span></a> <span class="kw op">-></span> <a class="pp">oncancel<span class="pc">oncancel: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;592</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
      &#95;      <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
    }
  },<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;592</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;591</span></span></a>)
</span>}

<span class="decl-val" id="cancel_exn"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancel_exn">cancel-exn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="dash">-</span>exn: <span class="tp">exception</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#exception">exception<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception</span></span></a>(<span class="st">"Cancel"</span>, <a class="pp" href="#con_space_Cancel"><span class="co">Cancel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Cancel: <span class="tp">exception<span class="dash">-</span>info</span></span></a></span>)

<span class="comment">// Execute &#96;action&#96; in a cancelable scope. If &#96;cancel&#96; is called within &#96;action&#96;,
// any outstanding asynchronous operations started in the cancelable scope are canceled but
// not outside it.
</span><span class="decl-fun" id="cancelable"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4594</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4593</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> 
{
  <span class="kw">var</span> <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>

  <a class="pp"><span class="kw">handle</span><span class="pc">return: <span class="tp sp">(</span><span class="tp tv">&#95;4593</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;4594</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4593</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#inject_st_1">inject-st<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>inject<span class="dash">-</span>st<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">st</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4594</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4593</span></span></a>)) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">4621</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()) <span class="kw op">-></span> io (), wid) <span class="kw op">-></span> <span class="op">&lt;</span>cps,read<span class="op">&lt;</span>&#95;4597<span class="op">&gt;</span>,write<span class="op">&lt;</span>&#95;4597<span class="op">&gt;</span>,async,alloc<span class="op">&lt;</span>&#95;4597<span class="op">&gt;</span><span class="op">|</span>&#95;4594<span class="op">&gt;</span> &#95;4593</span></a>(setup,wid) <span class="kw op">-></span> {
      <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="#_excl__eq_">!=<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(!=): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#wid_exit">wid-exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid<span class="dash">-</span>exit: <span class="tp">wid</span></span></a>) <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>,<a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
      <span class="kw">val</span> <a class="pp">res<span class="pc">res: <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">4621</span><span class="op">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="#await_2">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">4621</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()) <span class="kw op">-></span> io ()</span></a>,<a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>)
      <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">res</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#snd_1">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a>) <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#remove">remove<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>remove: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">i<span class="pc">i: <span class="tp">wid</span></span></a>) { <a class="pp">i<span class="pc">i: <span class="tp">wid</span></span></a> <a class="pp" href="#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">res<span class="pc">res: <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">4621</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#thd">thd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>thd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">c</span></span></a> } <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
      <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">4621</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>cps,read<span class="op">&lt;</span>&#95;4597<span class="op">&gt;</span>,write<span class="op">&lt;</span>&#95;4597<span class="op">&gt;</span>,async,alloc<span class="op">&lt;</span>&#95;4597<span class="op">&gt;</span><span class="op">|</span>&#95;4594<span class="op">&gt;</span> &#95;4593</span></a>(<a class="pp">res<span class="pc">res: <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">4621</span><span class="op">&gt;</span></span></a>)
    }    
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;4594</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4593</span></span></a>(wids) <span class="kw op">-></span> {
      <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;4594</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4593</span></span></a>(<a class="pp" href="#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">awaits</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">wids</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#nothing_ques_">nothing?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>nothing?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">maybe</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) <span class="kw">else</span> <a class="pp">wids<span class="pc">wids: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>))
    }
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_id">await-id<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;4594</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4593</span></span></a>() <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4597</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;4594</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4593</span></span></a>(<a class="pp" href="#await_id">await-id<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">wid</span></span></a>())
  }
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Async handlers: interleaved
// ----------------------------------------------------------------------------
</span>
<span class="decl-fun" id="async_handle_interleaved"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#async_handle_interleaved">async-handle-interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>handle<span class="dash">-</span>interleaved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>  
{
  <span class="kw">var</span> <a class="pp">latest<span class="pc">latest: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">some</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="#type_space_await_result"><span class="tp">await-result</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>result: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="kw op">:=</span> <span class="kw">fun</span>(<a class="pp">&#95;<span class="pc">&#95;(479,74): <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span></span></a>) { <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a> }
  
  <a class="pp"><span class="kw">handle</span><span class="pc">return: <span class="tp sp">(</span><span class="tp tv">&#95;228</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#inject_st_1">inject-st<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>inject<span class="dash">-</span>st<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">st</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>)) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()) <span class="kw op">-></span> io (), wid) <span class="kw op">-></span> <span class="op">&lt;</span>cps,async,exn,alloc<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span>,read<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span>,write<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span><span class="op">|</span>&#95;3543<span class="op">&gt;</span> &#95;228</span></a>(setup,wid) <span class="kw op">-></span> {
      <span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">some</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="#type_space_await_result"><span class="tp">await-result</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>result: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>
        <span class="kw">=</span> <a class="pp" href="#await_2">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
            <a class="pp">latest<span class="pc">latest: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
            <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()) <span class="kw op">-></span> io ()</span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span></span></a>) {
              <a class="pp">latest<span class="pc">latest: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>({<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>cps,async,exn,alloc<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span>,read<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span>,write<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span><span class="op">|</span>&#95;3543<span class="op">&gt;</span> &#95;228</span></a>(<a class="pp">x<span class="pc">x: <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span></span></a>)}), <a class="pp">x<span class="pc">x: <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#snd_1">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a>, <a class="pp">x<span class="pc">x: <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#thd">thd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>thd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">c</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a> ) 
            })
          },<a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>)
      <span class="kw">match</span>(<a class="pp">r<span class="pc">r: <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#fst_1">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>) {
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">3572</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>cps,async,exn,alloc<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span>,read<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span>,write<span class="op">&lt;</span>&#95;4184<span class="op">&gt;</span><span class="op">|</span>&#95;3543<span class="op">&gt;</span> &#95;228</span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>), <a class="pp">r<span class="pc">r: <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#snd_1">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a>, <a class="pp">r<span class="pc">r: <span class="tp">await<span class="dash">-</span>result</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#thd">thd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>thd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">c</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a>) 
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>)  <span class="kw op">-></span> <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>()
      }
    }
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>(wids) <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>(<a class="pp" href="#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">awaits</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">wids<span class="pc">wids: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>))
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_id">await-id<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>()   <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4184</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;3543</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;228</span></span></a>(<a class="pp" href="#await_id">await-id<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">wid</span></span></a>())
  }
</span>} 

<span class="comment">// ----------------------------------------------------------------------------
// Async handle
// ----------------------------------------------------------------------------
</span>
<span class="comment">// The outer &#96;:async&#96; effect handler
</span><span class="decl-fun" id="async_handle"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#async_handle">async-handle<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>handle: <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">io</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">io</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> 
{
  <span class="kw">var</span> <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ())<span class="op">&gt;</span><span class="op">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  
  <span class="decl-fun" id="outer_callback"><span class="kw">fun</span> <a class="pp">outer-callback<span class="pc">outer<span class="dash">-</span>callback: <span class="tp sp">(</span><span class="tp tpp">resume</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>io,cps<span class="op">&gt;</span> (), wid <span class="tp kw op">:</span> <span class="tp">wid</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,read<span class="op">&lt;</span>global<span class="op">&gt;</span>,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ((res <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> io ())</span></a>( <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>cps,io<span class="op">&gt;</span> ()</span></a>, <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a>) {
    <span class="kw">val</span> <a class="pp">oresume<span class="pc">oresume: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,read<span class="op">&lt;</span>global<span class="op">&gt;</span>,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#outer_resume">outer-resume<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>outer<span class="dash">-</span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">resume</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">io</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>cps,io<span class="op">&gt;</span> ()</span></a>)
    <span class="decl-fun" id="cb"><span class="kw">fun</span> <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tpp">res</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> io ()</span></a>(<a class="pp">res<span class="pc">res: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)</span></a>) {
      <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a>&#95;,<a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a>,<a class="pp">wid'<span class="pc">wid': <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp">res<span class="pc">res: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)</span></a>
      <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">awaits</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#contains">contains<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>contains: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">wid'<span class="pc">wid': <span class="tp">wid</span></span></a>)) {
        <span class="kw">if</span> (<a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ())<span class="op">&gt;</span><span class="op">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ())<span class="op">&gt;</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#remove">remove<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>remove: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">wid'<span class="pc">wid': <span class="tp">wid</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
        <a class="pp">oresume<span class="pc">oresume: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,read<span class="op">&lt;</span>global<span class="op">&gt;</span>,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>(<a class="pp">res<span class="pc">res: <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)</span></a>)
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">}</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
    </span>}
    <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="#_excl__eq_">!=<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(!=): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp" href="#wid_exit">wid-exit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid<span class="dash">-</span>exit: <span class="tp">wid</span></span></a>) <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ())<span class="op">&gt;</span><span class="op">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>,<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tpp">res</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> io ()</span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>,<a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ())<span class="op">&gt;</span><span class="op">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
    <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tpp">res</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> io ()</span></a>
  </span>}

  <span class="decl-fun" id="cancel_await"><span class="kw">fun</span> <a class="pp">cancel-await<span class="pc">cancel<span class="dash">-</span>await: <span class="tp sp">(</span><span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a> ) {
    <span class="kw">match</span>( <a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ())<span class="op">&gt;</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#lookup">lookup<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>lookup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>) ) {
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>  <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>) <span class="kw op">-></span> {
        <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#cancel_exn">cancel-exn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="dash">-</span>exn: <span class="tp">exception</span></span></a>),<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a>)
      }
    }
  </span>}

  <a class="pp"><span class="kw">handle</span><span class="pc">return: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">io</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {   
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">2830</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()) <span class="kw op">-></span> io (), wid) <span class="kw op">-></span> <span class="op">&lt;</span>div,read<span class="op">&lt;</span>global<span class="op">&gt;</span>,write<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,cps<span class="op">&gt;</span> ()</span></a>( setup, wid ) <span class="kw op">-></span> <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">2830</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()) <span class="kw op">-></span> io ()</span></a>( <a class="pp">outer-callback<span class="pc">outer<span class="dash">-</span>callback: <span class="tp sp">(</span><span class="tp tpp">resume</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>io,cps<span class="op">&gt;</span> (), wid <span class="tp kw op">:</span> <span class="tp">wid</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,read<span class="op">&lt;</span>global<span class="op">&gt;</span>,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ((res <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> io ())</span></a>(<a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>result</span><span class="tp op">&lt;$</span><span class="number">2830</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>cps,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,read<span class="op">&lt;</span>global<span class="op">&gt;</span>,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>,<a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>) )
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( wids )      <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">io</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">wids<span class="pc">wids: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">wid</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp">awaits<span class="pc">awaits: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">,</span><span class="tp op">$</span><span class="number">2830</span><span class="op">&gt;</span>, bool, wid)) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>global<span class="op">&gt;</span>,ui,div,exn,net,alloc<span class="op">&lt;</span>global<span class="op">&gt;</span>,console,file,ndet,write<span class="op">&lt;</span>global<span class="op">&gt;</span><span class="op">&gt;</span> ())<span class="op">&gt;</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>))<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#foreach">foreach<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>foreach: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">cancel-await<span class="pc">cancel<span class="dash">-</span>await: <span class="tp sp">(</span><span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> ))
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#await_id">await-id<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()          <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">io</span><span class="tp sp">,</span><span class="tp">cps</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="#con_space_Wid"><span class="co">Wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Wid: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">wid</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#unique">unique<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unique: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>()))
  }
</span>}

<span class="comment">// Convenience functions for wid maps
</span><span class="decl-fun" id="remove"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#remove">remove<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>remove: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;195</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;195</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#remove">remove<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>remove: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;195</span><span class="tp sp">)</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">&#95;</span><span class="pc">&#95;(540,25): <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a>) { <a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;195</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a> <a class="pp" href="#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> })
</span>}

<span class="decl-fun" id="lookup"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#lookup">lookup<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>lookup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;1676</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;1676</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#lookup">lookup<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>lookup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">wid</span></span></a><span class="tp kw op">:</span><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a>) { <a class="pp">x<span class="pc">x: <span class="tp">wid</span></span></a> <a class="pp" href="#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">wid1</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tpp">wid2</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> })
</span>}

<span class="decl-fun" id="contains"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_async.html#contains">contains<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>contains: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;1795</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_wid"><span class="tp">wid</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wid: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">&#95;1795</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#lookup">lookup<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>lookup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">wid</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">wid</span> <span class="tp kw op">:</span> <span class="tp">wid</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">wid<span class="pc">wid: <span class="tp">wid</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#bool_1">bool<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
</span>}</pre>

</div></body>
</html>
