<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>async.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;---------------------------------------------------------------------------
  Copyright 2012-2016 Microsoft Corporation.
 
  This is free software; you can redistribute it and/or modify it under the
  terms of the Apache License, Version 2.0. A copy of the License can be
  found in the file "license.txt" at the root of this distribution.
---------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Asynchronous primitives
</span><span class="kw">module</span> async

<span class="kw">import</span> int32
<span class="kw">import</span> duration

<span class="kw">extern</span> include {
  js file <span class="st">"async-inline.js"</span>
}

<span class="comment">// A type alias for asynchronous operations that can raise exceptions non-deterministically.
// This is common for almost all &#96;:async&#96; operations since &#96;cancelable&#96; and &#96;timeout&#96; can
// cancel operations non-deterministically which raises the &#96;Cancel&#96; exception and cancels
// outstanding asynchronous requests. 
</span><span class="decl-alias" id="type_space_asyncx"><span class="kw">public</span> <span class="tp kw">alias</span> <a class="pp" href="std_async.html#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <span class="tp kw">=</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a></span><span class="tp sp">&gt;</span>


<span class="comment">// ----------------------------------------------------------------------------
// Asynchronous timeout and waiting
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Do &#96;action&#96; but cancel it if it is not done within &#96;secs&#96; seconds. 
// Returns &#96;Nothing&#96; if canceled, and &#96;Just(x)&#96; if successful with a result &#96;x&#96;.
</span><span class="decl-fun" id="timeout"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#timeout">timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>, <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;899</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;898</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp" href="#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw">fun</span>(<a class="pp">cancel<span class="pc">cancel: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
    <span class="kw">val</span> <a class="pp">id<span class="pc">id: <span class="tp">timeout<span class="dash">-</span>id</span></span></a> <span class="kw">=</span> <a class="pp" href="#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <span class="kw">fun</span>(<a class="pp">&#95;<span class="pc">&#95;(34,31): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>){ <a class="pp">cancel<span class="pc">cancel: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(); }, <a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#milli_seconds">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_int32-source.html#int32">int32<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a> )
    <a class="pp" href="std_core-source.html#on_exit">on-exit<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>on<span class="dash">-</span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">hndler</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a>({ <a class="pp" href="#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">h</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">id<span class="pc">id: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>); <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a> }, <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;899</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;898</span></span></a>)
  }
</span>}

<span class="comment">// Wait (asynchronously) for &#96;secs&#96; seconds as a &#96;:double&#96;. 
// Use &#96;wait()&#96; to yield to other asynchronous operations.
</span><span class="decl-fun" id="wait"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#wait">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#wait_1">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#duration_2">duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>)
</span>}

<span class="comment">// Wait (asynchronously) for optional &#96;secs&#96; seconds &#96;:duration&#96; (&#96;= 0s&#96;). 
// Use &#96;wait()&#96; to yield generally to other asynchronous operations.
// If the wait time is longer than 200ms the wait can be canceled.
</span><span class="decl-fun" id="wait_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#wait_1">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp op">?</span><span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">secs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">200</span><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#milli_seconds_1">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp" href="#cancelable_wait">cancelable-wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable<span class="dash">-</span>wait: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a>) 
  <span class="kw">elif</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">secs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
  <span class="kw">else</span> <a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a>)
</span>}

<span class="comment">// Wait for &#96;secs&#96; seconds duration
</span><span class="decl-fun" id="cancelable_wait"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#cancelable_wait">cancelable-wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable<span class="dash">-</span>wait: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">secs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="kw">else</span> {
    <span class="kw">var</span> <a class="pp">mid<span class="pc">mid: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp" href="#on_cancel">on-cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>on<span class="dash">-</span>cancel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">oncancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
      <span class="kw">match</span>(<a class="pp">mid<span class="pc">mid: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
        <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
        <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">id<span class="pc">id: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>) <span class="kw op">-></span> <a class="pp" href="#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">h</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">id<span class="pc">id: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>)
      }
    }
    { <a class="pp" href="#unsafe_async_yield">unsafe-async-yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>async<span class="dash">-</span>yield: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">haserr</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { 
        <a class="pp">mid<span class="pc">mid: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;730</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#milli_seconds">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_int32-source.html#int32">int32<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>))      
      }
    }
  }
</span>}

<span class="decl-fun" id="yield"><span class="kw">fun</span> <a class="pp" href="std_async.html#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp op">?</span><span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#unsafe_async_yield">unsafe-async-yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>async<span class="dash">-</span>yield: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">haserr</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { <a class="pp" href="#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp" href="std_num_int32-source.html#max">max<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>max: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>(<a class="pp" href="std_num_int32-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>zero: <span class="tp">int32</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_num_int32-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a>,<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#milli_seconds">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_int32-source.html#int32">int32<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>)); <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a> } )
</span>}

<span class="comment">// abstract id for timeout handlers
</span><span class="decl-type" id="type_space_timeout_id"><span class="tp kw">type</span> <a class="pp" href="std_async.html#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a></span>

<span class="decl-fun" id="set_timeout"><span class="kw">extern</span> <a class="pp" href="std_async.html#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">&#95;244</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">ms<span class="pc">ms: <span class="tp">int32</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_num_int32-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a> {
  js <span class="st">"setTimeout"</span>
</span>}

<span class="decl-fun" id="clear_timeout"><span class="kw">extern</span> <a class="pp" href="std_async.html#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">h</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">h<span class="pc">h: <span class="tp">timeout<span class="dash">-</span>id</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  js <span class="st">"clearTimeout"</span>
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Asynchronous cancelation 
// ----------------------------------------------------------------------------
</span>
<span class="comment">// The &#96;Cancel&#96; exception.
</span><span class="decl-type" id="type_space_exception_info"><span class="kw">public</span> <span class="tp kw">type</span> <span class="tp">extend</span> <span class="tp">exception<span class="dash">-</span>info</span> {
  <span class="comment">// The &#96;Cancel&#96; exception is thrown when an asynchronous operation is canceled.
</span>  <span class="decl-con" id="con_space_Cancel"><span class="kw">con</span> <span class="decl-fun" id="cancel_ques_"><a class="pp" href="std_async.html#con_space_Cancel"><span class="co">Cancel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Cancel: <span class="tp">exception<span class="dash">-</span>info</span></span></a></span></span>
</span>}

<span class="decl-fun" id="on_cancel"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#on_cancel">on-cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>on<span class="dash">-</span>cancel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">oncancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">oncancel<span class="pc">oncancel: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;219</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;219</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;218</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="std_core-source.html#on_exn">on-exn<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>on<span class="dash">-</span>exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">hndler</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<span class="kw">fun</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) {
    <span class="kw">match</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#info">info<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>info: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>) {
      <a class="pp" href="#con_space_Cancel"><span class="co">Cancel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Cancel: <span class="tp">exception<span class="dash">-</span>info</span></span></a> <span class="kw op">-></span> <a class="pp">oncancel<span class="pc">oncancel: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;219</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
      &#95;      <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
    }
  },<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;219</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;218</span></span></a>)
</span>}

<span class="comment">// Execute an asynchronous &#96;action&#96; that gets passed as &#96;cancel&#96; function. If &#96;cancel&#96; is
// called, it will either raise the &#96;Cancel&#96; exception on the next asynchronous operation,
// or, if currently in an asynchronous operation, it will cancel the outstanding operation
// and resume by throwing &#96;Cancel&#96; at that point. If canceled, &#96;cancelable&#96; returns &#96;Nothing&#96;,
// and on success &#96;Just(x)&#96; where &#96;x&#96; is the result of &#96;action&#96;.
</span><span class="decl-fun" id="cancelable"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp tpp">cancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;595</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;528</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cancel</span><span class="tp kw op">:</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> { 
  <span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">unreg<span class="pc">unreg: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">caction<span class="pc">caction: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;595</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;528</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="#create_cancelable_prim">create-cancelable-prim<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>create<span class="dash">-</span>cancelable<span class="dash">-</span>prim: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp tpp">cancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;595</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;528</span></span></a>)
  <a class="pp" href="std_core-source.html#catch">catch<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>catch: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">hndl</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a> { 
    <span class="kw">val</span> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;528</span></span></a> <span class="kw">=</span> <a class="pp">caction<span class="pc">caction: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;595</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;528</span></span></a>()
    <a class="pp">unreg<span class="pc">unreg: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
    <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;528</span></span></a>) 
  } 
  <span class="kw">fun</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) {
    <a class="pp">unreg<span class="pc">unreg: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
    <span class="kw">match</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#info">info<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>info: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>) {
      <a class="pp" href="#con_space_Cancel"><span class="co">Cancel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Cancel: <span class="tp">exception<span class="dash">-</span>info</span></span></a> <span class="kw op">-></span> {
        <a class="pp" href="#check_canceled">check-canceled<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>check<span class="dash">-</span>canceled: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="comment">// will re-throw if action is not the one that was canceled
</span>        <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
      }
      &#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#throw">throw<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>throw: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
    }
  }
</span>}

<span class="decl-fun" id="create_cancelable_prim"><span class="kw">extern</span> <a class="pp" href="std_async.html#create_cancelable_prim">create-cancelable-prim<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>create<span class="dash">-</span>cancelable<span class="dash">-</span>prim: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp tpp">cancel</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;197</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;196</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cancel</span><span class="tp kw op">:</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  js <span class="st">"&#95;create&#95;cancelable"</span>
</span>}

<span class="decl-fun" id="check_canceled"><span class="kw">extern</span> <a class="pp" href="std_async.html#check_canceled">check-canceled<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>check<span class="dash">-</span>canceled: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  js <span class="st">"&#95;check&#95;canceled"</span>
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Asynchronous operations are supported through the &#96;:async&#96; effect.
// ----------------------------------------------------------------------------
</span>
<span class="decl-fun" id="async_fork"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#async_fork">async-fork<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>fork: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action1</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action2</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action1<span class="pc">action1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;406</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;405</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">action2<span class="pc">action2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;406</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">xs<span class="pc">xs: <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;405</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="#async_all_prim">async-all-prim<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>all<span class="dash">-</span>prim: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">actions</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>{ <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">action1<span class="pc">action1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;406</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;405</span></span></a>()) }, { <a class="pp">action2<span class="pc">action2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;406</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(); <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> }<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#vector_3">vector<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector<span class="postfix">.3</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> )
  <a class="pp" href="std_core-source.html#unsafe_noexn">unsafe-noexn<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>noexn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a>{ <a class="pp">xs<span class="pc">xs: <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;405</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>[]: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><span class="number">0</span>]<span class="kw op">.</span><a class="pp" href="std_core-source.html#unjust">unjust<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unjust: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a> }
</span>}

<span class="comment">// Execute &#96;actions&#96; asynchronously, i.e. interleaved around asynchronous operations.
// When all operations have terminated (or raised an exception) return the list of
// results (or raise the first raised exception).
</span><span class="decl-fun" id="async_all"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#async_all">async-all<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>all: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">actions</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">actions<span class="pc">actions: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;285</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;284</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp" href="#async_all_prim">async-all-prim<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>all<span class="dash">-</span>prim: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">actions</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">actions<span class="pc">actions: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;285</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;284</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#vector_3">vector<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector<span class="postfix">.3</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> )<span class="kw op">.</span><a class="pp" href="std_core-source.html#list_5">list<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>;
</span>}

<span class="decl-fun" id="async_all_prim"><span class="kw">extern</span> <a class="pp" href="std_async.html#async_all_prim">async-all-prim<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>all<span class="dash">-</span>prim: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">actions</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">actions<span class="pc">actions: <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;178</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;177</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_vector"><span class="tp">vector</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_vector"><span class="tp">vector</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>  {
  js inline <span class="st">"&#95;async&#95;all(actions,&#95;k)"</span>
</span>}


<span class="decl-fun" id="unsafe_async_yield_err"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#unsafe_async_yield_err">unsafe-async-yield-err<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>async<span class="dash">-</span>yield<span class="dash">-</span>err: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;972</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;973</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;973</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="#unsafe_async_yield">unsafe-async-yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>async<span class="dash">-</span>yield: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">haserr</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;972</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;973</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;973</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>, <a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> ) 
</span>}

<span class="decl-fun" id="unsafe_async_yield"><span class="kw">public</span> <span class="kw">extern</span> <a class="pp" href="std_async.html#unsafe_async_yield">unsafe-async-yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>async<span class="dash">-</span>yield: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">haserr</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;257</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;258</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">asyncx</span><span class="tp sp">|</span><span class="tp tv">&#95;258</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">haserr<span class="pc">haserr: <span class="tp op">?</span><span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  js inline <span class="st">"(#1)( &#95;async&#95;callback(&#95;k,#2), $std&#95;core.async&#95;yield)"</span>
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// Synchronous blocks (uninterleaved sequences of async operations)
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Execute any asynchronous actions inside &#96;action&#96; synchronously, ie. 
// no other actions are interleaved.
</span><span class="decl-fun" id="synchronous"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#synchronous">synchronous<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>synchronous: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;876</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;875</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="#start_synchronous">start-synchronous<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>start<span class="dash">-</span>synchronous: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
  <a class="pp" href="std_core-source.html#on_exit">on-exit<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>on<span class="dash">-</span>exit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">hndler</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a>(<a class="pp" href="#end_synchronous">end-synchronous<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>end<span class="dash">-</span>synchronous: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>){ <a class="pp" href="std_core-source.html#unsafe_total">unsafe-total<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>total: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp tv">a</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;876</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;875</span></span></a>) }
</span>}

<span class="decl-fun" id="start_synchronous"><span class="kw">extern</span> <a class="pp" href="std_async.html#start_synchronous">start-synchronous<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>start<span class="dash">-</span>synchronous: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  js <span class="st">"&#95;async&#95;start&#95;synchronous"</span>
</span>}

<span class="decl-fun" id="end_synchronous"><span class="kw">extern</span> <a class="pp" href="std_async.html#end_synchronous">end-synchronous<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>end<span class="dash">-</span>synchronous: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  js <span class="st">"&#95;async&#95;end&#95;synchronous"</span>
</span>}

</pre>

</div></body>
</html>
